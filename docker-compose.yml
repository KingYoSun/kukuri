services:
  # DHTブートストラップノード（kukuri-tauriが最初に接続するピア）
  kukuri-bootstrap:
    build:
      context: ./kukuri-cli
      dockerfile: Dockerfile
    container_name: kukuri-bootstrap-dev
    environment:
      KUKURI_SECRET_KEY: Lk2VhCbWDgGBJvr+OewZTc8WLs+rmcsvehAV8uVIEZg=
      LOG_LEVEL: info
      BIND_ADDRESS: 0.0.0.0:11223
    ports:
      - '11223:11223'
    volumes:
      - bootstrap-data:/home/kukuri/data
    restart: unless-stopped
    command: ['bootstrap']

  # Nostr互換リレー。デフォルトでpublicトピックを購読する
  kukuri-relay:
    build:
      context: ./kukuri-cli
      dockerfile: Dockerfile
    container_name: kukuri-relay-dev
    depends_on:
      - kukuri-bootstrap
    environment:
      KUKURI_SECRET_KEY: N55ru+z8dxH/5udqTeA0byBBw3is6DWAX0siMVqjbFw=
      LOG_LEVEL: info
      BIND_ADDRESS: 0.0.0.0:11225
      RELAY_TOPICS: kukuri:tauri:public
    ports:
      - '11225:11225'
    volumes:
      - relay-data:/home/kukuri/data
    restart: unless-stopped
    command: ['relay']

  # Relay using n0 bootstrap discovery (no local bootstrap dependency)
  kukuri-relay-n0:
    build:
      context: ./kukuri-cli
      dockerfile: Dockerfile
    container_name: kukuri-relay-n0
    environment:
      KUKURI_SECRET_KEY: 2Fo+P2s6E3GFol29SukyyHhlLRgtXgRQihHN1tyc7KY=
      LOG_LEVEL: info
      BIND_ADDRESS: 0.0.0.0:11226
      RELAY_TOPICS: kukuri:tauri:public
    ports:
      - '11226:11226'
    volumes:
      - relay-n0-data:/home/kukuri/data
    restart: unless-stopped
    command: ['relay']

volumes:
  bootstrap-data:
  relay-data:
  relay-n0-data:

