# kukuri ドキュメント概要

## プロジェクト概要
kukuriは、Nostrプロトコルをベースとした分散型トピック中心ソーシャルアプリケーションです。検閲耐性を持つP2Pネットワークを通じて、ユーザーがトピックベースで情報を共有・発見できるプラットフォームを提供します。

## ドキュメント構成

### 01_project/ - プロジェクト管理
- **design_doc.md**: プロジェクトの全体設計書
- **requirements.md**: 機能要件・非機能要件定義
- **activeContext/**: 現在の作業状況
  - current_tasks.md: 進行中のタスク
  - current_environment.md: 開発環境情報
  - issuesAndNotes.md: 既知の問題と注意事項
  - tauri_app_experience_design.md: Tauriアプリ体験設計
  - tauri_app_implementation_plan.md: Tauriアプリ実装計画
- **progressReports/**: 進捗レポート

### 02_architecture/ - アーキテクチャ設計
- **system_design.md**: システム設計詳細
  - レイヤー構成
  - データモデル
  - API設計
  - セキュリティ設計
- **project_structure.md**: プロジェクト構造
  - ディレクトリ構成
  - ファイル構造詳細
  - 開発ワークフロー

### 03_features/ - 機能仕様
- 各機能の詳細仕様書（作成予定）

### 04_data/ - データ設計
- データベーススキーマ
- Nostrイベント仕様（作成予定）

### 03_implementation/ - 実装ガイド
- **implementation_plan.md**: 段階的実装計画
  - Phase 1: MVP (3ヶ月)
  - Phase 2: ベータ版 (3ヶ月)
  - Phase 3: 正式リリース
- **storage_implementation_guide.md**: ストレージ実装ガイド
- **testing_guide.md**: テスト戦略と実装ガイド
- **iroh_gossip_integration_design.md**: iroh-gossip統合設計
- **iroh_gossip_implementation_plan.md**: iroh-gossip実装計画
- **iroh_gossip_test_implementation.md**: P2P機能テスト実装詳細

## 技術スタック

### フロントエンド
- React 18 + TypeScript
- Vite (ビルドツール)
- shadcn/ui (UIコンポーネント)
- Zustand (状態管理)
- Tanstack Query/Router

### バックエンド
- Tauri v2 (デスクトップフレームワーク)
- Rust (コアロジック)
- iroh (P2P通信基盤)
- iroh-gossip (トピックベースイベント配信)
- nostr-sdk (Nostrプロトコル)
- SQLite (ローカルDB)

### インフラ
- Cloudflare Workers / Docker (ピア発見)
- 分散マーケットプレイス (検索・推薦)

## 現在の開発状況 (2025年8月2日時点)

### 現在の課題と対応中の作業
- 🔧 **Tauriアプリケーション体験改善 Phase 3**
  - Phase 1（認証フロー）完了 ✅
  - Phase 2（データ連携）完了 ✅
  - Phase 3.1（トピック参加・離脱機能）完了 ✅
  - Phase 3.2（新規投稿機能の拡張）完了 ✅
  - Phase 3.3（その他のリアクション機能）開始待ち 🔄
  - → 詳細: activeContext/tauri_app_implementation_plan.md

### 完了済み機能
- ✅ **基盤実装**
  - Tauri v2プロジェクト構造
  - フロントエンド基盤（React 18 + TypeScript）
  - Rust基盤（鍵管理、暗号化、DB）
  - Tauriコマンドインターフェース
  - Windows/macOS/Linuxクロスプラットフォーム対応

- ✅ **Nostr統合**
  - Nostr SDK統合（v0.42.0）
  - イベント送受信機能
  - リレー接続・ヘルスチェック
  - 双方向同期（Nostr ↔ P2P）

- ✅ **P2P通信実装**
  - iroh-gossip統合（Day 1-5）
  - トピック管理機能
  - メッセージ署名・検証
  - イベント変換機能（Day 6）
  - 双方向同期機能（Day 7）
  - ハイブリッド配信（Day 8）
  - UI統合（Day 9）

- ✅ **UI/UX**
  - 基本レイアウト・ルーティング
  - P2P状態表示（サイドバー）
  - トピックメッシュ可視化
  - P2Pデバッグパネル

- ✅ **テスト・品質保証**
  - 517個のフロントエンドテスト
  - 156個のバックエンドテスト
  - 型チェック・リント完全クリーン
  - E2E/統合テスト基盤

- ✅ **データ連携・機能実装（Phase 2-3完了）**
  - 投稿の実データ取得・表示
  - トピック管理機能（作成・編集・削除）
  - リアルタイム更新機能
  - 返信・引用機能（NIP-10準拠）
  - 検索機能（投稿・トピック・ユーザー）
  - 手動P2P接続機能
  - リッチテキストエディタ（Markdownサポート）
  - メディア埋め込み機能
  - 下書き管理機能
  - 予約投稿UI（バックエンド実装は保留）

### 最近の成果
- 🎯 **タイムライン機能の改善（2025年8月2日）**
  - アカウント追加時に#publicトピックへの自動参加
  - トピック別タイムライン表示機能
  - 未同期投稿の「未同期」バッジ表示
  - 前回表示トピックの復元機能
  - タイムラインへの遷移導線の追加
- 🎆 **Windows環境アカウント永続化問題の解決（2025年8月2日）**
  - keyringライブラリのwindows-nativeフィーチャー有効化
  - Entry::new_with_target()からシンプルなEntry::new()に変更
  - 全プラットフォームで統一的な実装を実現

### 進行中の作業
- ⏳ パフォーマンステスト（Day 10）
- 🔧 Tauriアプリケーション Phase 3.3（その他のリアクション機能）

## 開発フェーズ

1. **Phase 1 (MVP)**: 基本機能実装 **[進行中]**
   - ユーザー管理 ✅
   - トピック作成・参加 ✅
   - 基本的なP2P通信 ✅
   - UI/UX実装 90%完了

2. **Phase 2 (ベータ)**: 高度な機能
   - 画像・動画対応
   - 検索・サジェスト機能
   - パフォーマンス最適化

3. **Phase 3**: エンタープライズ機能
   - トークンエコノミー
   - 高度なプライバシー機能
   - プラグインシステム

## 主要な設計決定

- **Nostr互換性**: 既存のNostrエコシステムとの相互運用性を維持
- **ハイブリッドP2P**: 純粋なP2Pの課題を回避しつつ分散性を確保
- **プライバシーファースト**: エンドツーエンド暗号化とローカル処理を優先
- **開発者フレンドリー**: OSSファーストでコミュニティ駆動の開発

## 更新履歴
- 2025年8月2日: Windows環境アカウント永続化問題の完全解決
- 2025年8月1日: Phase 3.2 新規投稿機能の拡張完了 - テスト総数517件に増加
- 2025年7月31日: Phase 3.1 トピック参加・離脱機能の改善完了
- 2025年7月30日: Phase 2.4 追加機能の完全実装
- 2025年7月29日: フロントエンドテストエラー完全解消 - 342件全てのテストが成功
- 2025年7月28日: Phase 2.2完了 - トピック管理と投稿作成機能の実装
- 2025年7月28日: Phase 2.1完了 - トピック一覧の実データ取得・表示機能実装
- 2025年7月28日: Phase 2.1部分完了 - 投稿の実データ取得・表示機能実装
- 2025年7月28日: Tauriアプリケーション Phase 1（認証フロー）のテスト作成完了
- 2025年7月28日: 実装優先順位決定（Tauriアプリ優先、手動P2P接続機能追加）
- 2025年7月28日: Tauriアプリケーション体験設計と実装計画作成
- 2025年7月28日: ドキュメント全体の更新（最新実装状況を反映）
- 2025年7月27日: Nostr統合 Day 9（P2P UI統合）完了
- 2025年7月27日: フロントエンドのテスト・型・リントエラー完全解消
- 2025年7月27日: Zustandテストのモック実装問題解決
- 2025年7月27日: テスト・型・リント修正作業（any型警告解消、署名検証修正）
- 2025年7月27日: P2Pトピック管理機能の包括的テスト実装
- 2025年7月26日: Prettier導入と開発環境改善
- 2025年7月26日: インテグレーションテスト実装、テストガイド追加
- 2025年7月26日: iroh-gossip採用に伴う技術スタック更新
- 2025年7月25日: 初版作成