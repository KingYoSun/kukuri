[title] 作業中タスク（in_progress）

最終更新日: 2025年11月13日

## 方針（2025年09月15日 更新）

- 当面は Nostr リレーとは接続しない（外部インデックスサーバー等の導入時に検討）。
- まず P2P（iroh + iroh-gossip + DHT）で一通りの体験が完結することを最優先。
- kukuri 内部のイベントは全て NIPs 準拠（内部フォーマットは Nostr Event スキーマを準拠・整合）。
- テスト戦略: Tauri v2 では E2E が困難なため、層別テスト（ユニット/結合/契約）＋スモーク最小限に切替。

## 現在のタスク

### リファクタリング計画 2025-08-08 v3 未完了タスク

1. **機能使用状況マップ: アクティブ機能の洗い出し**  
   - 背景: `docs/01_project/refactoring_plan_2025-08-08_v3.md:213` のチェックリストが未記入。  
   - やること: `phase5_user_flow_inventory.md`・`phase5_user_flow_summary.md` を突き合わせ、UI から呼べる全機能と実装ファイルを Markdown テーブルに整理。  
   - 完了条件: 機能名／呼び出し元／実装箇所が網羅されたドキュメントを作成し、チェックを完了させる。

2. **機能使用状況マップ: 未使用機能（削除候補）の整理**  
   - 背景: 同ドキュメントの未使用機能セクション（`refactoring_plan_2025-08-08_v3.md:216`）が空欄。  
   - やること: dead_code や未導線コマンドを洗い出し、削除・保留判断とソース位置を列挙。  
   - 完了条件: 削除候補一覧が記載され、削除方針（削除・保留）が決定されている。

3. **機能使用状況マップ: 部分的に使用される機能の可視化**  
   - 背景: `refactoring_plan_2025-08-08_v3.md:219` のチェックが未完。  
   - やること: 一部画面からのみ到達できるコンポーネント/コマンドを列挙し、使用箇所と未使用箇所を明記。  
   - 完了条件: すべての部分利用機能に対して使用/未使用の両方の文脈が記録される。

4. **すべてのRustテストをグリーンに戻す**  
   - 背景: `modules::offline::tests` 系で 8 件失敗が続いており（`refactoring_plan_2025-08-08_v3.md:81-84`）、成功指標 `すべてのRustテスト成功`（同:424）が未達。  
   - やること: SQLite パーミッション問題の再現・修正、`cargo test`（`kukuri-tauri/src-tauri` と `kukuri-cli`）の連続実行で確認。  
   - 完了条件: 両ディレクトリで `cargo test` が成功し、ドキュメントのチェックを完了できる。

5. **コード重複率30%削減の達成**  
   - 背景: 成功指標（`refactoring_plan_2025-08-08_v3.md:425`）が未達で、Phase4 DRY 施策の実行が途中。  
   - やること: 4.1 共通化方針（共通モック／ストア基盤）を具現化し、重複計測（lint/coverage ツール）で 30% 減を証明。  
   - 完了条件: 重複率レポートを添えて 30% 以上削減したことを記録し、チェックを更新。

6. **未使用APIエンドポイントをゼロにする**  
   - 背景: 成功指標（`refactoring_plan_2025-08-08_v3.md:436`）未達。残タスクは `add_relay` / `join_topic_by_name` / `delete_events` / `get_nostr_pubkey` 等（同:437-440）。  
   - やること: 各コマンドを UI に接続するか、不要であれば削除案＋テスト更新を提示。  
   - 完了条件: 未使用 API が 0 件であることをドキュメント化し、チェックを完了。

7. **孤立コンポーネントをゼロにする**  
   - 背景: 成功指標（`refactoring_plan_2025-08-08_v3.md:441-443`）未達。鍵管理ダイアログ等が導線未接続のまま。  
   - やること: Sidebar/Header など既存導線に統合するか、不要な UI は廃止。テストケースも更新。  
   - 完了条件: 全コンポーネントの導線が明示され、孤立要素が解消されている。

8. **dead_code の 80%以上を削除または活用**  
   - 背景: `refactoring_plan_2025-08-08_v3.md:444-446` による残タスク。`hybrid_distributor` / `event_sync` / `offline_api` 周辺に候補が集中。  
   - やること: dead_code 一覧を精査し、使用開始 or 削除のいずれかに分類。削除時は SQLx / Rust テストで回帰確認。  
   - 完了条件: dead_code 削減率が 80% 以上になり、成果を artefact として記録。

9. **すべての Tauri コマンドをフロントエンド導線へ接続**  
   - 背景: 成功指標（`refactoring_plan_2025-08-08_v3.md:447-449`）が未完。`add_relay` `join_topic_by_name` 等が UI から未呼び出し。  
   - やること: コマンド単位で呼び出し経路を追加し、`phase5_user_flow_summary.md` / `phase5_ci_path_audit.md` のリンク更新。  
   - 完了条件: すべてのコマンドに UI からの呼び出しパスが存在し、成功指標チェックを閉じられる。
