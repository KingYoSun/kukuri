# 2026年02月04日 作業完了タスク

最終更新日: 2026年02月04日

## Community Nodes cn-admin-api 契約テスト

- [x] access_control rotate/revoke の成功系契約テストを追加
- [x] POST /v1/reindex の成功系契約テストを追加

## GitHub Actions community-node-tests 失敗対応

- [x] community-node-tests で Apache AGE を含む Postgres イメージをビルドして起動する手順を追加
- [x] `DATABASE_URL` を 15432 ポートに切り替え、起動/停止フローを明示
- [x] `shared_preload_libraries=age` を指定して拡張がロードされるよう調整

## GitHub Actions Desktop E2E 失敗対応

- [x] scripts/docker/run-desktop-e2e.sh で tauri-driver の空きポート選択を追加（既存の TAURI_DRIVER_PORT 指定は尊重）

## 検証

- [x] docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -v C:\\Users\\kgm11\\kukuri:/app -w /app/kukuri-community-node rust:1.88-bookworm bash -c "cargo test -p cn-admin-api --tests -- --nocapture"
- [x] ./scripts/test-docker.ps1 e2e-community-node（TAURI_DRIVER_PORT 自動選定を確認）
- [x] gh act --workflows .github/workflows/test.yml --job format-check（git clone の some refs were not updated / pnpm approve-builds 警告あり）
- [x] gh act --workflows .github/workflows/test.yml --job native-test-linux（git clone の some refs were not updated / act(useRouter) 警告あり）
- [x] gh act --workflows .github/workflows/test.yml --job community-node-tests（初回は 5432 競合 → 15432 で再実行、成功）
