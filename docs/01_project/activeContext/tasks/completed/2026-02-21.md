# 2026年02月21日 完了タスク

最終更新日: 2026年02月21日

## Issue #111 trust モデルを NIP-85（30382-30385/10040）へ全面置換

- [x] legacy trust kind（39010/39011）を NIP-85 trust assertion / provider list kind（30382-30385/10040）へ移行し、型・定数・バリデーション・生成ロジックを更新。
- [x] Community Node / Tauri 間の trust API・DTO・クライアント・UI の trust provider（NIP-85）経路を更新。
- [x] 旧 trust anchor 保存値の互換移行を残しつつ、実運用経路は NIP-85 に統一。
- [x] trust 関連テスト（Rust/TS/統合）とドキュメントを更新。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-21_issue111_nip85_trust_migration.md` を追加。

## 検証

- [x] `docker compose -f docker-compose.test.yml up -d community-node-postgres`（pass）
- [x] `docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -v "$(git rev-parse --show-toplevel):/workspace" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc "set -euo pipefail; source /usr/local/cargo/env; cargo test --workspace --all-features; cargo build --release -p cn-cli"`（pass）
- [x] `bash ./scripts/test-docker.sh rust`（pass）
- [x] `bash ./scripts/test-docker.sh ts`（pass）
- [x] `docker compose -f docker-compose.test.yml run --rm lint-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## PR #112 Codex review 対応（TrustProviderList validation 強化）

- [x] `kind 10040` の `:rank` タグに対して、tag名prefix kind の妥当性（`30382-30385`）を検証するよう `cn-kip-types` のバリデーションを強化。
- [x] provider pubkey を 64桁hex公開鍵として検証し、無効値を reject するよう更新。
- [x] `invalid kind prefix` / `invalid pubkey` / `valid` のユニットテストを追加・更新。

## 検証（PR #112）

- [x] `docker compose -f docker-compose.test.yml up -d community-node-postgres`（pass）
- [x] `docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -v "$(git rev-parse --show-toplevel):/workspace" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc "set -euo pipefail; source /usr/local/cargo/env; cargo test -p cn-kip-types"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）
