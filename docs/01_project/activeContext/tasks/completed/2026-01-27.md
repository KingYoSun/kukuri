# 2026年01月27日 完了タスク

最終更新日: 2026年01月27日

## Community Node E2E 組み込み

- [x] E2E 用 Community Node モックサーバーを追加し、WDIO 起動時に自動起動するようにした
- [x] Community Node 設定 UI に data-testid を追加し、E2E から安定して操作できるようにした
- [x] Community Node 設定/認証/同意取得の E2E シナリオを追加

### 検証

- `./scripts/test-docker.ps1 e2e`
- `gh act --workflows .github/workflows/test.yml --job format-check`（警告: `git clone` の `some refs were not updated`、`pnpm approve-builds`）
- `gh act --workflows .github/workflows/test.yml --job native-test-linux`（警告: `git clone` の `some refs were not updated`、`useRouter must be used inside a <RouterProvider>`）

## Community Nodes E2E 実ノード経路追加

- [x] docker-compose.test.yml に community node (Postgres/Meilisearch/User API) 起動経路を追加し、E2E の base URL を配布できるように整理。
- [x] scripts/test-docker.ps1/scripts/test-docker.sh に community node 用 E2E コマンドを追加し、SCENARIO と E2E_COMMUNITY_NODE_URL を設定。
- [x] WDIO の community node モック切替と E2E チェック条件を実ノード対応に更新。

## Community Nodes E2E 実ノードシード整備

- [x] `cn e2e seed/cleanup` を追加し、DB/Meilisearch にユーザー/トピック/投稿/label/trust のシード投入/掃除を実装。
- [x] `scripts/test-docker.ps1`/`scripts/test-docker.sh` の `e2e-community-node` で seed/cleanup を自動実行。

### 検証

- `gh act --workflows .github/workflows/test.yml --job format-check`（失敗: Docker pull 認証エラー `authentication required - incorrect username or password`）
- `gh act --workflows .github/workflows/test.yml --job native-test-linux`（失敗: Docker pull 認証エラー `authentication required - incorrect username or password`）

## GitHub Actions 失敗修正（Desktop E2E: community node）

- [x] `scripts/test-docker.ps1`/`scripts/test-docker.sh` の community node seed/cleanup 実行を `--entrypoint cn` に統一し、`/bin/sh -c` 経由の引数欠落を解消。

### 検証

- `gh run view 21398562889 --log-failed`（Desktop E2E の `cn` 実行失敗を確認）
- `gh act --workflows .github/workflows/test.yml --job desktop-e2e`（失敗: act-latest で `pwsh` が見つからず）
- `gh act --workflows .github/workflows/test.yml --job desktop-e2e -P ubuntu-latest=ghcr.io/catthehacker/ubuntu:full-latest`（中断: image pull が長時間）
- `gh act --workflows .github/workflows/test.yml --job format-check`（成功。警告: `git clone` の `some refs were not updated`、`pnpm approve-builds`）
- `gh act --workflows .github/workflows/test.yml --job native-test-linux`（成功。警告: `git clone` の `some refs were not updated`）
