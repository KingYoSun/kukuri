# 2026年02月25日 完了タスク

最終更新日: 2026年02月25日

## Issue #165: Profile save が `TauriCommandError: Nostr operation failed` で失敗する問題の修正

- [x] `ProfileEditDialog` -> `update_nostr_metadata` -> `EventManager::update_metadata` のエラーフローを調査し、失敗起点を特定。
- [x] root cause を「metadata publish が relay 未接続時にフォールバックせず `client.send_event` エラーをそのまま返す実装不整合」と確認。
- [x] `publish_topic_post` と同等の relay 未接続 graceful handling を `update_metadata` に実装。
- [x] no-relay 判定を `allow_no_relay_publish` として共通化し、`publish_text_note` も同じ判定ロジックへ統一。
- [x] 統合テスト `update_metadata_succeeds_without_relays_and_broadcasts_to_p2p` を追加し、relay なしローカル環境での回帰を防止。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue165_profile_save_no_relay_graceful_handling.md` を追加。

## 検証（Issue #165）

- [x] `cd kukuri-tauri/src-tauri && cargo fmt --check`（pass）
- [x] `cd kukuri-tauri/src-tauri && cargo test`（pass）
- [x] `docker run --rm -v /home/kingyosun/kukuri:/workspace -w /workspace/kukuri-tauri node:22-bullseye bash -lc "corepack enable && pnpm --version && pnpm format:check && pnpm lint && pnpm type-check"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #171: 品質ゲート運用不備（PRテンプレート未適用・close条件未強制）の修正

- [x] `.github/workflows/verify-close-condition.yml` を修正し、`bug` ラベルのみでなく `[Bug]` タイトル・バグテンプレート由来本文でもバグIssue判定するよう改善。
- [x] `verified-fixed` 未付与で close されたバグIssueを自動再オープンし、必要条件をコメントで通知するフローを維持。
- [x] `.github/workflows/validate-pr-template.yml` を追加し、PR本文の必須セクション・`Closes #<id>`・`@codex` 記載を検証する品質ゲートを新設。
- [x] `.github/pull_request_template.md` に `@codex` レビュー依頼の記載例を追加。
- [x] `.github/ISSUE_TEMPLATE/bug_report.md` に `bug` ラベル維持と `verified-fixed` 必須条件を明記。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue171_quality_gate_enforcement.md` を追加。

## 検証（Issue #171）

- [x] `cd kukuri-tauri/src-tauri && cargo fmt`（pass）
- [x] `docker run --rm -e CI=true -v /home/kingyosun/kukuri:/workspace -w /workspace/kukuri-tauri node:22-bullseye bash -lc "set -euo pipefail; corepack enable; pnpm --version; pnpm install --frozen-lockfile; pnpm format:check; pnpm lint"`（pass）

## Issue #167: Timeline/Thread ビューが Tauri クライアントで見つからない問題の修正

- [x] `App.tsx` / TanStack Router 構成とトピック関連 route を調査し、ルート自体は登録済みであることを確認。
- [x] `Sidebar` のトピッククリック遷移が `/topics/$topicId` ではなく `/` 固定になっていたため、実装済みの Timeline/Thread route に到達できない root cause を特定。
- [x] `handleTopicClick` を `/topics/$topicId` へ遷移するよう修正し、Topic Timeline 画面への導線を復旧。
- [x] `Sidebar` ユニットテストのナビゲーション期待値を新しい route（`/topics/$topicId` + params）へ更新して回帰を防止。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue167_topic_route_navigation_fix.md` を追加。

## 検証（Issue #167）

- [x] `docker compose -f docker-compose.test.yml run --rm ts-test bash -lc "cd /app/kukuri-tauri && if [ ! -f node_modules/.bin/vitest ]; then pnpm install --frozen-lockfile --ignore-workspace; fi && pnpm vitest run src/tests/unit/components/layout/Sidebar.test.tsx"`（pass）
- [x] `docker compose -f docker-compose.test.yml run --rm ts-test bash -lc "cd /app/kukuri-tauri && pnpm vitest run src/tests/unit/routes"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #174: 自動品質ゲート改善 #1（Close Conditions 修正と reopen 通知）

- [x] `.github/ISSUE_TEMPLATE/bug_report.md` の Close Conditions を Bot 実運用に合わせて現実的な項目へ更新。
- [x] Close Conditions に `CI（Test workflow の required checks）成功` を必須項目として追加。
- [x] `.github/workflows/verify-close-condition.yml` に、`verified-fixed` 未達で自動 reopen した際の Discord webhook 通知を追加（payload `flags: 4`）。
- [x] close 条件未達時コメントを `verified-fixed` + CI success + 検証証跡の3要件を明示する文言へ更新。
- [x] 運用ルールドキュメント `docs/03_implementation/ci_required_checks_policy.md` に Issue close 品質ゲート方針を追記。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue174_quality_gate_improvement_1.md` を追加。

## 検証（Issue #174）

- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act issues -W .github/workflows/verify-close-condition.yml -j enforce-verified-fixed -e tmp/act-events/issues-closed-verified.json`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act issues -W .github/workflows/verify-close-condition.yml -j enforce-verified-fixed -e tmp/act-events/issues-closed-missing-verified.json`（known fail: ダミー Issue #999998 が存在しないため GitHub API 404）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #175: Playwright スクリーンショットの Cloudflare R2 永続化

- [x] `.github/workflows/test.yml` の `playwright-tauri-smoke` ジョブに R2 アップロード処理を追加し、`kukuri-tauri/test-results` の画像（png/jpg/jpeg/webp）を `kukuri-screenshots` バケットへ保存する実装を追加。
- [x] Cloudflare API（managed/custom domain）から公開ドメインを解決し、公開ドメイン未解決時は 7日署名付きURLへフォールバックする URL 生成処理を追加。
- [x] PR 実行時にスクリーンショット URL を PR コメントへ自動投稿（既存Botコメントは更新）するステップを追加。
- [x] fork PR ではコメント投稿をスキップするガードを追加。
- [x] Playwright スクリーンショット処理完了時に Discord webhook へ completion callback を送信するステップを追加（payload は `flags: 4`）。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue175_playwright_screenshots_r2.md` を追加。

## 検証（Issue #175）

- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-test-format-check-issue175-rerun.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-test-native-test-linux-issue175-rerun.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-test-community-node-tests-issue175-rerun.log`（pass）

## Issue #175 再実装（reopen対応）: 成功時スクリーンショット取得の欠落修正

- [x] `kukuri-tauri/playwright.config.ts` の `use.screenshot` を `only-on-failure` から `on` に変更し、成功時にもスクリーンショットが生成されるよう修正。
- [x] `.github/workflows/test.yml` の Playwright スクリーンショットアップロードステップ名を「success + failure」に更新し、意図を明示。
- [x] スクリーンショット URL manifest（`tmp/playwright-r2-urls.tsv`）のパスを step output に公開し、CI 出力から追跡しやすく改善。
- [x] `tmp/playwright-r2-comment.md` / `tmp/playwright-r2-urls.tsv` を Playwright artifact に同梱し、URL 一覧の可読性・再確認性を向上。
- [x] 失敗時診断に利用する既存の `kukuri-tauri/playwright-report` / `kukuri-tauri/test-results` artifact 出力は維持。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue175_rework_success_screenshot_capture.md` を追加。

## 検証（Issue #175 再実装）

- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #164: Community Node Admin UI の Bootstrap 専用ページ化

- [x] `admin-console` サイドバー内の Bootstrap 詳細カードを撤去し、専用ページ遷移に変更。
- [x] サイドバーへ `Bootstrap` ナビゲーション項目を追加し、`/bootstrap` ルートを新設。
- [x] 専用ページで `node_id@host:port` 形式表示、接続ユーザー一覧、接続ユーザー数表示を実装（0件時の空表示を含む）。
- [x] `App.test.tsx` を新導線に合わせて更新し、`BootstrapPage.test.tsx` を追加して表示要件回帰を固定化。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue164_admin_bootstrap_page.md` を追加。

## 検証（Issue #164）

- [x] `docker run --rm -v /home/kingyosun/kukuri:/workspace -w /workspace/kukuri-community-node/apps/admin-console node:22-bullseye bash -lc "set -euo pipefail; corepack enable; pnpm --version; pnpm install --frozen-lockfile; pnpm test src/App.test.tsx src/pages/BootstrapPage.test.tsx; pnpm typecheck"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue164.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue164.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue164.log`（pass）
