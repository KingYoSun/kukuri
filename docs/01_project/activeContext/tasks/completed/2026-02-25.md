# 2026年02月25日 完了タスク

最終更新日: 2026年02月25日

## Issue #165: Profile save が `TauriCommandError: Nostr operation failed` で失敗する問題の修正

- [x] `ProfileEditDialog` -> `update_nostr_metadata` -> `EventManager::update_metadata` のエラーフローを調査し、失敗起点を特定。
- [x] root cause を「metadata publish が relay 未接続時にフォールバックせず `client.send_event` エラーをそのまま返す実装不整合」と確認。
- [x] `publish_topic_post` と同等の relay 未接続 graceful handling を `update_metadata` に実装。
- [x] no-relay 判定を `allow_no_relay_publish` として共通化し、`publish_text_note` も同じ判定ロジックへ統一。
- [x] 統合テスト `update_metadata_succeeds_without_relays_and_broadcasts_to_p2p` を追加し、relay なしローカル環境での回帰を防止。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue165_profile_save_no_relay_graceful_handling.md` を追加。

## 検証（Issue #165）

- [x] `cd kukuri-tauri/src-tauri && cargo fmt --check`（pass）
- [x] `cd kukuri-tauri/src-tauri && cargo test`（pass）
- [x] `docker run --rm -v /home/kingyosun/kukuri:/workspace -w /workspace/kukuri-tauri node:22-bullseye bash -lc "corepack enable && pnpm --version && pnpm format:check && pnpm lint && pnpm type-check"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）
