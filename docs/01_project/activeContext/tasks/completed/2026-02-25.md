# 2026年02月25日 完了タスク

最終更新日: 2026年02月25日

## Issue #165: Profile save が `TauriCommandError: Nostr operation failed` で失敗する問題の修正

- [x] `ProfileEditDialog` -> `update_nostr_metadata` -> `EventManager::update_metadata` のエラーフローを調査し、失敗起点を特定。
- [x] root cause を「metadata publish が relay 未接続時にフォールバックせず `client.send_event` エラーをそのまま返す実装不整合」と確認。
- [x] `publish_topic_post` と同等の relay 未接続 graceful handling を `update_metadata` に実装。
- [x] no-relay 判定を `allow_no_relay_publish` として共通化し、`publish_text_note` も同じ判定ロジックへ統一。
- [x] 統合テスト `update_metadata_succeeds_without_relays_and_broadcasts_to_p2p` を追加し、relay なしローカル環境での回帰を防止。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue165_profile_save_no_relay_graceful_handling.md` を追加。

## 検証（Issue #165）

- [x] `cd kukuri-tauri/src-tauri && cargo fmt --check`（pass）
- [x] `cd kukuri-tauri/src-tauri && cargo test`（pass）
- [x] `docker run --rm -v /home/kingyosun/kukuri:/workspace -w /workspace/kukuri-tauri node:22-bullseye bash -lc "corepack enable && pnpm --version && pnpm format:check && pnpm lint && pnpm type-check"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #171: 品質ゲート運用不備（PRテンプレート未適用・close条件未強制）の修正

- [x] `.github/workflows/verify-close-condition.yml` を修正し、`bug` ラベルのみでなく `[Bug]` タイトル・バグテンプレート由来本文でもバグIssue判定するよう改善。
- [x] `verified-fixed` 未付与で close されたバグIssueを自動再オープンし、必要条件をコメントで通知するフローを維持。
- [x] `.github/workflows/validate-pr-template.yml` を追加し、PR本文の必須セクション・`Closes #<id>`・`@codex` 記載を検証する品質ゲートを新設。
- [x] `.github/pull_request_template.md` に `@codex` レビュー依頼の記載例を追加。
- [x] `.github/ISSUE_TEMPLATE/bug_report.md` に `bug` ラベル維持と `verified-fixed` 必須条件を明記。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue171_quality_gate_enforcement.md` を追加。

## 検証（Issue #171）

- [x] `cd kukuri-tauri/src-tauri && cargo fmt`（pass）
- [x] `docker run --rm -e CI=true -v /home/kingyosun/kukuri:/workspace -w /workspace/kukuri-tauri node:22-bullseye bash -lc "set -euo pipefail; corepack enable; pnpm --version; pnpm install --frozen-lockfile; pnpm format:check; pnpm lint"`（pass）

## Issue #167: Timeline/Thread ビューが Tauri クライアントで見つからない問題の修正

- [x] `App.tsx` / TanStack Router 構成とトピック関連 route を調査し、ルート自体は登録済みであることを確認。
- [x] `Sidebar` のトピッククリック遷移が `/topics/$topicId` ではなく `/` 固定になっていたため、実装済みの Timeline/Thread route に到達できない root cause を特定。
- [x] `handleTopicClick` を `/topics/$topicId` へ遷移するよう修正し、Topic Timeline 画面への導線を復旧。
- [x] `Sidebar` ユニットテストのナビゲーション期待値を新しい route（`/topics/$topicId` + params）へ更新して回帰を防止。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-25_issue167_topic_route_navigation_fix.md` を追加。

## 検証（Issue #167）

- [x] `docker compose -f docker-compose.test.yml run --rm ts-test bash -lc "cd /app/kukuri-tauri && if [ ! -f node_modules/.bin/vitest ]; then pnpm install --frozen-lockfile --ignore-workspace; fi && pnpm vitest run src/tests/unit/components/layout/Sidebar.test.tsx"`（pass）
- [x] `docker compose -f docker-compose.test.yml run --rm ts-test bash -lc "cd /app/kukuri-tauri && pnpm vitest run src/tests/unit/routes"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）
