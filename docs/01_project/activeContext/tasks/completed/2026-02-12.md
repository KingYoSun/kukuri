# 2026年02月12日 完了タスク

最終更新日: 2026年02月12日

## Community Nodes / `cn-cli` Node Key + Access Control 統合テスト

- [x] `cn-cli` の `node-key generate/rotate/show` 統合テストを追加し、監査ログ記録とCLI出力互換を検証
- [x] `cn-cli` の `access-control rotate/revoke` 統合テストを追加し、監査ログ・DB反映・CLI出力互換を検証
- [x] `cn-cli` 実装に `access_control.rotate` / `access_control.revoke` の監査ログ記録を追加
- [x] `community_nodes_roadmap.md` の該当未実装項目を完了へ更新
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-12_cn_cli_access_control_node_key_integration_tests.md` を作成

## 検証

- [x] `./scripts/test-docker.ps1 rust -NoBuild`（成功）
  - `tmp/logs/test-docker-rust-cn-cli-access-control-20260211-235253.log`
- [x] `gh act --workflows .github/workflows/test.yml --job format-check`
  - 初回失敗（`rustfmt` 差分）: `tmp/logs/gh-act-format-check-cn-cli-access-control-20260211-235325.log`
  - `cargo fmt --all` 後の再実行成功: `tmp/logs/gh-act-format-check-cn-cli-access-control-20260211-235448.log`
- [x] `gh act --workflows .github/workflows/test.yml --job native-test-linux`（成功）
  - `tmp/logs/gh-act-native-test-linux-cn-cli-access-control-20260211-235608.log`
- [x] `gh act --workflows .github/workflows/test.yml --job community-node-tests`（成功）
  - `tmp/logs/gh-act-community-node-tests-cn-cli-access-control-20260212-000304.log`

## Community Nodes / Access Control 再配布結果の記録・参照（success/failed/pending + reason）

- [x] `cn-core` に再配布結果記録を追加し、epoch rotate/revoke で `pending -> success|failed` と `reason` を保存できるようにした
- [x] `cn-admin-api` に再配布結果 API（`GET /v1/admin/access-control/distribution-results`）を追加し、rotate/revoke レスポンスへ `distribution_results` を追加した
- [x] Admin Console（Access Control）に再配布結果の可視化（集計 + failed/pending 一覧 + 検索）を追加した
- [x] DB マイグレーション `kukuri-community-node/migrations/20260211000000_access_control_distribution_results.sql` を追加した
- [x] `community_nodes_roadmap.md` の該当未実装項目2件を完了（`[x]`）へ更新した
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-12_access_control_distribution_results.md` を作成した

## 検証（Access Control 再配布結果）

- [x] `./scripts/test-docker.ps1 rust -NoBuild`（ログ上成功）
  - `tmp/logs/test-docker-rust-access-control-distribution-20260212-035553.log`
- [x] `./scripts/test-docker.ps1 ts -NoBuild`（ログ上成功）
  - `tmp/logs/test-docker-ts-access-control-distribution-20260212-035613.log`
- [x] `docker run --rm -v ${PWD}:/workspace -w /workspace/kukuri-community-node/apps/admin-console -e CI=true node:20-bookworm bash -lc "corepack enable && pnpm install --frozen-lockfile && pnpm test -- src/pages/AccessControlPage.test.tsx"`（成功）
  - `tmp/logs/docker-admin-console-access-control-page-20260212-040903.log`
- [x] `gh act --workflows .github/workflows/test.yml --job format-check`（成功）
  - `tmp/logs/gh-act-format-check-access-control-distribution-20260212-035709.log`
- [x] `gh act --workflows .github/workflows/test.yml --job native-test-linux`（成功）
  - `tmp/logs/gh-act-native-test-linux-access-control-distribution-20260212-035828.log`
- [x] `gh act --workflows .github/workflows/test.yml --job community-node-tests`（成功）
  - `tmp/logs/gh-act-community-node-tests-access-control-distribution-20260212-040450.log`

## GitHub Actions 実行時間短縮（全方針一括対応）受け入れ条件確認

- [x] `test.yml` の直近5実行平均が 40 分未満であることを確認
  - 対象 run: `21917213675`(8.32分, success), `21910691648`(36.32分, success), `21909688930`(27.40分, cancelled), `21907509258`(34.18分, success), `21906408713`(33.60分, cancelled)
  - 平均: `27.96` 分（`concurrency` によるキャンセルを含む）
- [x] docs-only 変更で重いジョブが起動しないことを確認
  - 実 run（push/docs-only）: `21917213675` で `Docker Test Suite` / `Desktop E2E (Community Node, Docker)` / `Push Heavy Checks` が `skipped`
  - `pull_request` dry-run: `gh act pull_request --workflows .github/workflows/test.yml --job docker-test --dryrun --verbose`
    - ログ: `tmp/logs/gh-act-dryrun-pull-request-docker-test-20260212.log`（`Skipping job 'Docker Test Suite'`）
  - `pull_request` dry-run: `gh act pull_request --workflows .github/workflows/test.yml --job desktop-e2e --dryrun --verbose`
    - ログ: `tmp/logs/gh-act-dryrun-pull-request-desktop-e2e-20260212.log`（`Skipping job 'Desktop E2E (Community Node, Docker)'`）
- [x] required checks の運用方針がドキュメント化済み
  - `docs/03_implementation/ci_required_checks_policy.md`

## Community Nodes / `recovery-drill` の月次CI統合（`nightly.yml`）

- [x] `.github/workflows/nightly.yml` に `community-node-recovery-drill` ジョブを追加
- [x] UTC 日付ガードを実装し、`workflow_dispatch` または UTC 毎月1日のみ `recovery-drill` を実行するようにした
- [x] `./scripts/test-docker.ps1 recovery-drill` 実行後、`test-results/community-node-recovery/latest-summary.json` を `jq` で検証するステップを追加
- [x] `tmp/logs/community-node-recovery` と `test-results/community-node-recovery` を Nightly artefact として収集するようにした
- [x] `docs/03_implementation/community_nodes/ops_runbook.md` に定期CI連携を追記し、`community_nodes_roadmap.md` の該当未実装項目を完了へ更新
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-12_community_node_recovery_drill_monthly_ci.md` を作成

## 検証（`recovery-drill` 月次CI統合）

- [x] `gh act --workflows .github/workflows/test.yml --job format-check`（成功）
  - `tmp/logs/gh-act-format-check-recovery-ci-20260212-055400.log`
- [x] `gh act --workflows .github/workflows/test.yml --job native-test-linux`（成功）
  - `tmp/logs/gh-act-native-test-linux-recovery-ci-20260212-055522.log`
- [x] `gh act --workflows .github/workflows/test.yml --job community-node-tests`（成功）
  - `tmp/logs/gh-act-community-node-tests-recovery-ci-20260212-060145.log`
- [x] `gh act workflow_dispatch --workflows .github/workflows/nightly.yml --job community-node-recovery-drill`（`act` コンテナ内に `pwsh` が無いため失敗。GitHub Hosted Runner では `pwsh` 利用可）
  - `tmp/logs/gh-act-nightly-community-node-recovery-drill-20260212-060600.log`
