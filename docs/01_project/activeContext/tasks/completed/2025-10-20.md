# 2025年10月20日 完了タスク

## Phase 4 DRY 適用 - テスト支援コード/ストア共通化
- `application/shared/tests/{event,p2p}/` を新設し、`modules/event` と `modules/p2p` のテストサポートを shared 層へ移行。既存 `support` モジュールは薄い re-export のみに整理し、Event/P2P 双方のフィクスチャ・モック・ロギングを共通利用化。
- EventPublisher / DefaultTopicsRegistry を `application/shared/nostr` および `application/shared/default_topics.rs` に集約し、EventService・EventManager 間のイベント生成ロジックと既定トピック操作の重複を解消。
- Zustand ストア (`authStore`, `draftStore`, `offlineStore`, `p2pStore`, `topicStore`) に `withPersist` テンプレートと `config/persist.ts` を導入。Map 永続化用 `createMapAwareStorage` と `setupPersistMock` を整備し、persist 設定とテストモックを統一。
- 検証: `pnpm test --run src/stores`、`./scripts/test-docker.ps1 rust` を実行し、TypeScript/Rust 双方で後方互換を確認。
