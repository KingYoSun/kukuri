# 2025年11月09日 完了タスク

最終更新日: 2025年11月09日

## MVP Exit Checklist 仕上げ（DM/設定/検索/Sync/DHT）

- [x] `ProfileSetup` / `ProfileEditDialog` / `SettingsPage` にプライバシー設定の永続化を実装し、`update_privacy_settings` コマンド + DB マイグレーションを適用。`ProfileSetup.test.tsx` / `ProfileEditDialog.test.tsx` / `routes/settings.test.tsx` で `kukuri_privacy` 連携を確認。
- [x] `useUserSearchQuery` の型/状態マシンを整理し、`SearchErrorState`・`DirectMessageInbox` を含む検索 UI を `@tanstack/react-query` v5 の推奨パターンへ移行。`pnpm vitest src/tests/unit/components/search/UserSearchResults.test.tsx src/tests/unit/hooks/useUserSearchQuery.test.tsx` を追加実行。
- [x] Rust の `UserSearchService` にカーソルフォールバック（npub ベース）を実装し、`user_handler`/`post_service`/`post_cache`/`user_service` の新フィールド（public_profile/show_online_status）初期化を更新。`cargo test`（ネイティブは Windows 既知の `STATUS_ENTRYPOINT_NOT_FOUND` で失敗）後、`./scripts/test-docker.ps1 rust -NoBuild` で全 Rust テストを Docker 上で完走。
- [x] `SyncStatusIndicator` / `OfflineIndicator` のメタデータ表示をドキュメント（Inventory 5.5 / Runbook）へ反映し、MVP Exit Checklist の該当行を ✅ に更新。`pnpm test`/`pnpm lint`/`pnpm type-check` を再実行し、`cargo test`（`kukuri-cli`）も成功を確認。

### 実行コマンド
- `pnpm test`
- `pnpm lint`
- `pnpm type-check`
- `cargo test`（`kukuri-tauri/src-tauri`：STATUS_ENTRYPOINT_NOT_FOUND のため Docker へ切替）
- `./scripts/test-docker.ps1 rust -NoBuild`
- `cargo test`（`kukuri-cli`）

## Offline sync_queue Stage3（Queue履歴 UI + list_sync_queue_items）

- [x] `offline_handler` に `list_sync_queue_items` を追加し、`offlineApi.listSyncQueueItems`・`useSyncManager` から 60 秒間隔＋手動操作で再送キュー履歴 (`queueItems`) を取得。`SyncStatusIndicator` に Queue ID フィルタ／最新 ID ハイライト／ステータス別バッジ／要求者・要求時刻・発行元・再試行回数／失敗メッセージを表示する履歴セクションを実装し、`OfflineIndicator` のコピーと誘導を統合。
- [x] `src/tests/unit/hooks/useSyncManager.test.tsx` に再送履歴取得ケース、`src/tests/unit/components/SyncStatusIndicator.test.tsx` に履歴 UI・フィルタリング・エラーハンドリングを追加。`phase5_user_flow_inventory.md` / `phase5_user_flow_summary.md` / `phase5_ci_path_audit.md` の Offine sync_queue 行とテストパスを更新。

### 実行コマンド
- `npx vitest run src/tests/unit/hooks/useSyncManager.test.tsx src/tests/unit/components/SyncStatusIndicator.test.tsx src/tests/unit/components/OfflineIndicator.test.tsx`
- `cargo test`（`kukuri-tauri/src-tauri`：Windows ではタイムアウトするため、`./scripts/test-docker.ps1 rust -NoBuild` で代替実行）
- `cargo test`（`kukuri-cli`）
