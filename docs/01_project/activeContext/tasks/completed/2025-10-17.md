# 2025年10月17日 完了タスク

## P2P ステータス API のメトリクス要約対応
- `kukuri-tauri/src-tauri/src/application/services/p2p_service.rs` で Gossip メトリクスのスナップショットをまとめ、`metrics_summary` として返却。
- DTO (`presentation/dto/p2p.rs`) とハンドラ (`presentation/handlers/p2p_handler.rs`) を更新し、フロント側が要約値を受け取れるよう整備。
- `p2pStore` / `useP2P` / `P2PStatus` などフロントサイドの状態管理を変更し、メトリクスのリフレッシュボタンから `refreshStatus` を再利用。

## NIP-10 契約テスト共通化
- `testdata/nip10_contract_cases.json` を追加し、Rust (`tests/nip10_contract_tests.rs`) と TypeScript (`src/lib/__tests__/nip10.contract.test.ts`) で共通ケースを実行。
- `contract_testing::validate_nip10_tags` を導入し、アプリ本体のエンティティ検証ロジックをそのままテストで利用。

## 開発支援スクリプトの拡張
- `scripts/test-docker.ps1` に `metrics` / `contracts` サブコマンドを追加し、対象テストのみを Docker 経由で実行可能にした。

## 既知の課題 / フォローアップ
- `cargo test` は Windows 環境の DLL 依存により依然として `STATUS_ENTRYPOINT_NOT_FOUND` で失敗。個別の `cargo test --test nip10_contract_tests` は完走済み。
- `pnpm test` は JSX のローカライズ文字列を調整中。P2P UI 周りのスナップショットが安定した段階で再実行する。

## NIP-10 契約ケース拡張と Docker スモークテスト縮小タスク整理
- `kukuri-tauri/testdata/nip10_contract_cases.json` を bech32（note/nevent/npub/nprofile）およびリレー数上限を含む12ケースまで拡張し、Rust (`docker run --rm -w /app/kukuri-tauri/src-tauri kukuri-rust-test cargo test --test nip10_contract_tests`) と TypeScript (`docker run --rm -w /app/kukuri-tauri kukuri-ts-test pnpm vitest run src/lib/__tests__/nip10.contract.test.ts`) の契約テストで整合性を確認。
- Docker スモークテスト構成の軽量化タスクを `docs/01_project/activeContext/tasks/context/docker_smoke_tests.md` に集約し、Compose 分割・ベースイメージ最適化・スクリプト更新のフォローアップを明文化。
