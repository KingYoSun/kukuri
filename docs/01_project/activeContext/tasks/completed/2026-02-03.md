# 2026年02月03日 作業完了タスク

最終更新日: 2026年02月03日

## Access Control P2P-only 整合（User API invite/keys撤去）

- [x] User API（cn-user-api）から `/v1/invite/redeem` と `/v1/keys/envelopes` を削除し、購読系ロジックも整理
- [x] Tauri/フロントの invite/keys 同期フローを撤去し、P2P の join.request へ切り替え
- [x] E2E/Unit/Mock を P2P-only 前提に更新
- [x] community nodes 関連ドキュメントの P2P-only 方針を明記し整合
- [x] 進捗レポートを作成（`docs/01_project/progressReports/2026-02-03_access_control_p2p_only_alignment.md`）

## Community Node 通報 UI/E2E

- [x] PostCard に通報メニューと理由選択ダイアログを追加し、`community_node_submit_report` を送信
- [x] E2E に `community-node.report.spec.ts` を追加し、seed 投稿の通報送信を検証
- [x] community node report API 型と PostCard unit test を更新
- [x] 進捗レポートを作成（`docs/01_project/progressReports/2026-02-03_community_node_report_ui_e2e.md`）

## Community Node label/attestation クライアント検証

- [x] label/attestation の署名/exp/採用ノード検証を追加し、未採用ノード由来のデータを除外
- [x] trust スコア集約は有効な attestation を持つノードのみ採用するよう調整
- [x] Tauri の検証ロジックに unit テストを追加
- [x] 進捗レポートを作成（`docs/01_project/progressReports/2026-02-03_community_node_label_attestation_validation.md`）

## Community Nodes テスト不足の補完

- [x] `cn-kip-types` の 39001/39005/39010/39011/39020 検証テストを追加
- [x] `cn-user-api` の `/v1/bootstrap/*` `/v1/reports` `/v1/search` 契約テストを追加
- [x] `cn-admin-api` login/logout の契約テストを追加
- [x] `kukuri-tauri` `CommunityNodeHandler` の単体テストを追加
- [x] 進捗レポートを作成（`docs/01_project/progressReports/2026-02-03_community_nodes_test_gap_fill.md`）

## GitHub Actions 失敗対応

- [x] `cn-kip-types` の `validate_key_envelope_accepts_valid_event` で自己 `p` タグが削除される前提を避けるため、署名鍵と受信者鍵を分離
- [x] `cn-user-api` のテスト用ルートを axum v0.8 形式の `{topic_id}` に修正
- [x] `gh act --workflows .github/workflows/test.yml --job community-node-tests` / `--job format-check` / `--job native-test-linux` を実行し成功（Vitest の act/useRouter 警告は既知）
- [x] 進捗レポートを作成（`docs/01_project/progressReports/2026-02-03_github_actions_fix.md`）

## テスト

- [x] `./scripts/test-docker.ps1 rust`
- [x] `./scripts/test-docker.ps1 ts`（React act/useRouter 警告は既知）
- [x] `./scripts/test-docker.ps1 e2e-community-node`（15 specs pass、`tmp/logs/community-node-e2e/20260203-032326.log`）
- [x] `gh act --workflows .github/workflows/test.yml --job format-check`（git clone の non-terminating warning/依存 script の警告あり）
- [x] `gh act --workflows .github/workflows/test.yml --job native-test-linux`（React act/useRouter 警告・`ReactDOMTestUtils.act` 非推奨警告、`ENABLE_P2P_INTEGRATION` 未設定による skip あり）
- [x] `./scripts/test-docker.ps1 rust`（Community Nodes テスト補完分の再実行）
