# 2025年11月11日 完了タスク

最終更新日: 2025年11月11日

## Offline sync_queue Stage4 実装

- [x] `cache_metadata` に Doc/Blob 情報（`doc_version` / `blob_hash` / `payload_bytes`）を保持するマイグレーションを適用し、`offline_handler::record_sync_queue_metadata` / `update_cache_metadata` / `cache_status` が値を返すよう Rust 実装とテスト（`add_to_sync_queue_records_metadata_entry` / `cache_status_includes_doc_fields`）を更新。
- [x] `SyncStatusIndicator` に Doc/Blob 競合バナーとサマリーカードを追加し、Vitest で Doc/Blob 比較タブ・競合バナー・`cache-doc-*` セクションの検証を追加。`phase5_user_flow_inventory.md` / `phase5_user_flow_summary.md` / `tauri_app_implementation_plan.md` / `phase5_ci_path_audit.md` を Stage4 完了状態に更新。
- [x] `scripts/test-docker.sh ts --scenario offline-sync --no-build` で Service Worker 経由の再送シナリオを実行できるよう `docker-compose.test.yml` に `./tmp/logs:/app/tmp/logs` を追加し、`tmp/logs/sync_status_indicator_stage4_20251111-185040.log` を採取。

### 実行コマンド

- `npx vitest run src/tests/unit/components/SyncStatusIndicator.test.tsx src/tests/unit/hooks/useSyncManager.test.tsx src/tests/unit/components/OfflineIndicator.test.tsx`
- `cargo test`（`kukuri-tauri/src-tauri`）
- `cargo test`（`kukuri-cli`）
- `./scripts/test-docker.sh build`
- `./scripts/test-docker.sh ts --scenario offline-sync --no-build`

## トレンド/フォロー Summary Panel + `trending_metrics_job` 監視

- [x] `scripts/test-docker.{sh,ps1} ts --scenario trending-feed` に `prometheus-trending` サービスの自動起動と `curl http://127.0.0.1:9898/metrics` スナップショット採取を追加し、`tmp/logs/trending_metrics_job_stage4_20251111-191137.log`（`Prometheus` ログ付き）を生成。
- [x] `docs/03_implementation/trending_metrics_job.md` / `docs/03_implementation/p2p_mainline_runbook.md` / `phase5_user_flow_summary.md` / `phase5_user_flow_inventory.md` / `phase5_ci_path_audit.md` / `phase5_dependency_inventory_template.md` / `docs/01_project/roadmap.md` / `docs/01_project/design_doc.md` に監視手順・artefact パス・MVP ステータスを反映し、Stage4 backlog（Prometheus 監視＋Nightly成果物固定）を解消。

### 実行コマンド

- `./scripts/test-docker.sh ts --scenario trending-feed --no-build`
