# 2025年11月11日 完了タスク

最終更新日: 2025年11月11日

## Offline sync_queue Stage4 実装

- [x] `cache_metadata` に Doc/Blob 情報（`doc_version` / `blob_hash` / `payload_bytes`）を保持するマイグレーションを適用し、`offline_handler::record_sync_queue_metadata` / `update_cache_metadata` / `cache_status` が値を返すよう Rust 実装とテスト（`add_to_sync_queue_records_metadata_entry` / `cache_status_includes_doc_fields`）を更新。
- [x] `SyncStatusIndicator` に Doc/Blob 競合バナーとサマリーカードを追加し、Vitest で Doc/Blob 比較タブ・競合バナー・`cache-doc-*` セクションの検証を追加。`phase5_user_flow_inventory.md` / `phase5_user_flow_summary.md` / `tauri_app_implementation_plan.md` / `phase5_ci_path_audit.md` を Stage4 完了状態に更新。
- [x] `scripts/test-docker.sh ts --scenario offline-sync --no-build` で Service Worker 経由の再送シナリオを実行できるよう `docker-compose.test.yml` に `./tmp/logs:/app/tmp/logs` を追加し、`tmp/logs/sync_status_indicator_stage4_20251111-185040.log` を採取。

### 実行コマンド

- `npx vitest run src/tests/unit/components/SyncStatusIndicator.test.tsx src/tests/unit/hooks/useSyncManager.test.tsx src/tests/unit/components/OfflineIndicator.test.tsx`
- `cargo test`（`kukuri-tauri/src-tauri`）
- `cargo test`（`kukuri-cli`）
- `./scripts/test-docker.sh build`
- `./scripts/test-docker.sh ts --scenario offline-sync --no-build`
