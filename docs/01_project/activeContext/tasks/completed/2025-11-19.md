## GitHub Actions ワークフロー安定化（Task 24）

- [x] `kukuri-tauri/src/tests/unit` 配下の DM/Quote/Reply/プロフィール/同期テストを共通の `createToastMock`/Zustand モックで再配線し、Vitest 実行時に `ReferenceError` が発生していた `vi.mock` の順序依存を解消。
- [x] `scripts/check_date_format.py` に UTF-8 以外の Markdown を安全に読み込むフォールバックを追加し、`docs/` 内の Shift_JIS/UTF-16 ファイルでも日付フォーマット検証が通るように修正。
- [x] Prettier で `src/tests/**/*` と `src/tests/utils/zustandTestUtils.ts` を再フォーマットし、`pnpm format:check` を通過させた。
- [x] `./scripts/test-docker.ps1 ts` を実行して 90 件の Vitest/ESLint を Docker 上で完走させたうえで、`gh act --job format-check` と `gh act --job native-test-linux` を実行。後者は Docker ソケット権限不足で CLI の docker_connectivity テストが失敗することを確認し、ログを収集済み。

### 主な変更ファイル

- `kukuri-tauri/src/tests/unit/components/directMessages/DirectMessageDialog.test.tsx`
- `kukuri-tauri/src/tests/unit/components/posts/QuoteForm.test.tsx`
- `kukuri-tauri/src/tests/unit/components/posts/ReplyForm.test.tsx`
- `kukuri-tauri/src/tests/unit/hooks/useOffline.test.tsx`
- `kukuri-tauri/src/tests/unit/hooks/useSyncManager.test.tsx`
- `kukuri-tauri/src/tests/unit/routes/profile.$userId.test.tsx`
- `kukuri-tauri/src/tests/utils/zustandTestUtils.ts`
- `scripts/check_date_format.py`

### 実行コマンド

- `powershell.exe -NoLogo -NonInteractive -ExecutionPolicy Bypass -File ./scripts/test-docker.ps1 ts`
- `gh act --workflows .github/workflows/test.yml --job format-check --env NPM_CONFIG_PREFIX=/tmp/npm-global`
- `gh act --workflows .github/workflows/test.yml --job native-test-linux --env NPM_CONFIG_PREFIX=/tmp/npm-global`

## 未使用 API エンドポイント 0 件の達成（Task 21）

- [x] `node scripts/check-tauri-commands.mjs` を実行（CLI 出力: "Tauri コマンド 84 件はすべてフロントエンドから呼び出されています。"）し、84/84 件の `#[tauri::command]` が UI/Hook/テストコードから参照されていることを確認。ホスト環境には `corepack pnpm` が無いため `pnpm run check:tauri-commands` は実行できず、CI 側で同スクリプトを実行し続ける運用で整合性を取る方針を明記。
- [x] `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md` Sec.3.2/3.3 を 2025年11月18日版へ更新し、未接続コマンド 0 件と監査ログ（`add_relay` ほか撤去日）を記録。
- [x] `phase5_feature_usage_map.md`・`phase5_user_flow_summary.md`・`phase5_ci_path_audit.md` にも同じ監査結果と今後の運用ルールを追記し、`refactoring_plan_2025-08-08_v3.md` の KPI「未使用 API エンドポイント 0 件」を達成済みに変更。
- [x] `docs/01_project/activeContext/tasks/status/in_progress.md` から Task 21 を削除し、`tasks/completed/2025-11-19.md` へ記録。

### 主な変更ファイル

- `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md`
- `docs/01_project/activeContext/artefacts/phase5_feature_usage_map.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_summary.md`
- `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md`
- `docs/01_project/refactoring_plan_2025-08-08_v3.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 実行コマンド

- `node scripts/check-tauri-commands.mjs`

## 孤立コンポーネント 0 件の証跡化（Task 22）

- [x] `phase5_user_flow_inventory.md` 1.5 行・Sec.2 のギャップ一覧を更新し、`KeyManagementDialog` の稼働状況を明記。Sec.5.13 では `KeyManagementDialog` / Summary Panel / `SyncStatusIndicator` の導線・テレメトリ・Docker テストを一覧化し、孤立コンポーネントが 0 件であることを証跡化。
- [x] `phase5_user_flow_summary.md` 1.5 節とグローバル要素・導線ギャップ表・優先度テーブルを更新し、孤立状態の解消と Inventory/Runbook 参照先を同期。
- [x] `docs/03_implementation/p2p_mainline_runbook.md` Chapter4.4 に孤立コンポーネント監査の手順を追記し、`refactoring_plan_2025-08-08_v3.md` KPI「孤立コンポーネント0件」を達成済みに変更。
- [x] `tasks/status/in_progress.md` から Task 22 を削除し、本ファイルへ完了ログを追記。

### 主な変更ファイル

- `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_summary.md`
- `docs/03_implementation/p2p_mainline_runbook.md`
- `docs/01_project/refactoring_plan_2025-08-08_v3.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 実行コマンド

- なし（ドキュメント更新のみ）

## dead_code の 80% 以上削除（Task 23）

- [x] `rg '#\[allow(dead_code)' -g '*.rs'` を `tmp/logs/dead_code_inventory_20251119-053142.log` / `...-053645.log` に採取し、Phase 5 CI 監査へリスト化。7件あった `#![allow(dead_code)]` を 0 件まで削減。
- [x] 未参照の `kukuri-tauri/src-tauri/src/modules` ツリーを丸ごと削除し、`lib.rs` から `mod modules;` を撤去。`p2p_metrics_export` は `test_support` への依存をやめ、`lib.rs` で `TopicMetricsRepository` / `SqliteRepository` / `ConnectionPool` / `AppConfig` を再エクスポートして実装層を直接利用できるようにした。
- [x] `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md` に dead_code セクションを新設し、削除対象の証跡と `./scripts/test-docker.ps1 rust` ログ（`tmp/logs/test_docker_rust_20251119-055648.log`）を紐付け。`p2p_mainline_runbook.md`・`refactoring_plan_2025-08-08_v3.md` も同日の更新履歴に追記。
- [x] `./scripts/test-docker.ps1 rust` を実行して 190 件の Rust テストと Contract/P2P スモークを再実行。TypeScript 側は `docker compose ... lint-check` で `pnpm lint` / `pnpm format:check` を走らせ、ログ `tmp/logs/pnpm_lint_20251119-055434.log` を取得。`cargo fmt`/`cargo clippy` は `application/shared/tests/mod.rs` の UTF-8 解析で Rust 1.86.0 が panic する既知不具合により失敗（`tmp/logs/test_docker_lint_20251119-055329.log` / `tmp/logs/cargo_clippy_20251119-055408.log`）することを確認し、Runbook へワークアラウンド（LF 変換・ASCII コメント化済み、今後は `rustup toolchain` 更新待ち）として記録。

### 主な変更ファイル

- `kukuri-tauri/src-tauri/src/bin/p2p_metrics_export.rs`
- `kukuri-tauri/src-tauri/src/lib.rs`
- `kukuri-tauri/src-tauri/src/application/shared/tests/mod.rs`
- `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md`
- `docs/03_implementation/p2p_mainline_runbook.md`
- `docs/01_project/refactoring_plan_2025-08-08_v3.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 実行コマンド

- `rg '#\[allow(dead_code)' -g '*.rs' | Tee-Object tmp/logs/dead_code_inventory_20251119-053142.log`
- `./scripts/test-docker.ps1 rust`
- `docker compose -f docker-compose.test.yml run --rm --entrypoint bash lint-check -lc 'cd /app/kukuri-tauri && pnpm lint && pnpm format:check'`
- `docker compose -f docker-compose.test.yml run --rm --entrypoint bash lint-check -lc 'export PATH=/usr/local/cargo/bin:$PATH; cd /app/kukuri-tauri/src-tauri && cargo clippy --workspace --all-features -- -D warnings'`（`rustfmt`/`rustc` panic のため失敗ログのみ取得）
