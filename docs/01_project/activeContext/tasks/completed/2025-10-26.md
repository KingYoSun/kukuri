# 2025年10月26日 完了タスク

## Phase 5 BookmarkManager アーカイブ - BM-ARCH-01
- `modules/bookmark/{manager,types,tests}.rs` と `modules/mod.rs` の再エクスポートを削除し、Legacy BookmarkManager を退役。`PostService` / `BookmarkRepository` 依存のみで bookmark API が動作する構成を前提に Stage3 をクローズした。
- `phase5_dependency_inventory_template.md` / `docs/01_project/deprecated/refactoring_plan_2025-08-08_v3.md` / `tauri_app_implementation_plan.md` / `docs/03_implementation/nostr_reactions_implementation.md` を更新し、Bookmark API の現行導線とドメイン境界を明文化。
- 検証: `cargo test`（kukuri-tauri/src-tauri: `linking with cc failed` で停止、Windows 環境の既知事象）／`cargo test`（kukuri-cli: 成功）。

## Phase 5 Workstream B - Rustカバレッジ計測定着（WSB-01）
- `docker-compose.test.yml` に `rust-coverage` サービスを追加し、`cargo tarpaulin --locked --all-features --skip-clean --out Json --out Lcov --output-dir /app/test-results/tarpaulin --timeout 1800` を実行するコンテナを整備。`scripts/test-docker.{sh,ps1}` に `coverage` コマンドを実装し、成果物のコピーとカバレッジ表示を自動化した。
- `docs/01_project/activeContext/artefacts/metrics/2025-10-26-153751-tarpaulin.{json,lcov}` を生成し、`tasks/metrics/test_results.md` / `phase5_test_inventory.md` / `p2p_mainline_runbook.md` / `phase5_ci_path_audit.md` を tarpaulin 手順と閾値で更新。初回測定結果（25.23%）と `./scripts/test-docker.sh coverage` の運用手順を記録。
- 検証: `./scripts/test-docker.sh rust`（Rust 全テスト）／`./scripts/test-docker.sh coverage`（tarpaulin レポート生成）。

## Phase 5 AuthService Lifecycle ポート導入（AUTH-LC-01）
- `application/ports/auth_lifecycle.rs` を新設し、AuthLifecycleEvent/Stage/Context と `AuthLifecyclePort` を定義。`AuthService` は KeyManager/SecureStorage/ポートのみを依存に持ち、アカウント作成・ログイン時はイベントを発行してプロビジョニングを委譲する構成へ刷新した。
- `application/services/auth_lifecycle.rs` で `DefaultAuthLifecycle` を実装し、UserService/TopicService を用いたユーザー生成と既定トピック参加、購読復元を担保。ユニットテストでイベント種別ごとの呼び出しを検証し、`tasks/status/in_progress.md` と `phase5_dependency_inventory_template.md` を更新。
- 検証: `cargo fmt`／`cargo test`（kukuri-tauri/src-tauri）／`cargo test`（kukuri-cli）。

## Phase 5 P2P Bootstrapper 再配置（P2P-BS-01）
- `state/application_container.rs` を廃止し、P2P 初期化専用の `infrastructure::p2p::bootstrap::P2PBootstrapper` を追加。Iroh SecretKey 生成、AppConfig 読み込み、`metrics::reset_all` を含む P2P スタック構築を集約し、`AppState` から Iroh 具象型/Builder 参照を排除した。
- `state.rs` と `tasks/status/in_progress.md` / `phase5_dependency_inventory_template.md` を更新し、P2PBootstrapper による DI ルートとメトリクス初期化の統一を記録。新モジュールには従来の秘密鍵生成テストを移設し回帰を確保。
- 検証: `cargo test`（kukuri-tauri/src-tauri）／`cargo test`（kukuri-cli）。
