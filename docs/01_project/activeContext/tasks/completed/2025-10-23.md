# 2025年10月23日 完了タスク

## Phase 5 TypeScript テスト再編・DI 統合検証
- `src/tests/unit`／`integration` 配下へ既存の TypeScript テストを全面移行し、旧 `src/__tests__` / `src/test` ディレクトリを撤去。`package.json`・`tsconfig.json`・`vitest.config.ts` の参照パスを新構成に合わせて更新。
- 重複していたコンポーネント／ストアテストを統合。`PostCard` テストではブースト・ブックマーク・未同期バッジなど Phase 5 で追加された振る舞いを再度カバーしつつ、`topicStore` と `authStore` の結合ケースを一つに整理。
- `src/tests/integration/di/store_di.integration.test.ts` を新設し、`useP2PStore.initialize` と `offlineSyncService.triggerSync` の依存注入フローを検証する DI 統合テストを追加。
- `src/tests/unit/lib/nip10.contract.test.ts` のテストデータ読み込みをリポジトリ直下の `testdata/nip10_contract_cases.json` 参照に修正し、TypeScript/Rust 双方の契約テストで共通データを保持。
- `docs/01_project/activeContext/artefacts/phase5_test_inventory.md` を更新し、Hooks／Stores／Integration の不足項目を解消した構成と新規 DI テストを記録。`tasks/status/in_progress.md` から当該タスクをクローズ。
- 検証: `pnpm test` を実行し、新ディレクトリ構成で 63 ファイル・679 件のテストが全て成功することを確認。

## GitHub Actions Format Check 整形対応
- `Format Check` ジョブが `src/tests/...` 配下の 5 ファイルで Prettier 警告を検出して失敗していたため、`pnpm prettier --write` で対象テストファイルを整形し、`pnpm format:check` と `gh act -j format-check -W .github/workflows/test.yml` で再発がないことを確認。

## Phase 5 契約テスト移行・CI 更新
- `tests/nip10_contract_tests.rs` を `tests/contract.rs`（エントリポイント）＋`tests/contract/nip10.rs` へ再配置し、`include_str!` を `env!("CARGO_MANIFEST_DIR")` ベースへ変更。
- `scripts/test-docker.ps1 contracts` の Rust テスト呼び出しを `cargo test --test contract` へ切り替え、TypeScript 契約テストのパスを `src/tests/unit/lib/nip10.contract.test.ts` に更新。実行コンテナを `ts-test` から `test-runner` に変更し、依存解決を安定化。
- `phase5_test_inventory.md`・`tasks/status/in_progress.md`・`docker_smoke_tests.md` を新ディレクトリ構成とコマンドに合わせて更新。
- 検証: `./scripts/test-docker.ps1 contracts` を実行し、Rust 契約テストと TypeScript 契約テストが Docker 上で完了することを確認（Rust 側は既知の `description` フィールド未使用警告のみ）。
