# 2026年02月13日 完了タスク

## Community Nodes / `cn-relay` `/healthz` ready 依存判定拡張

- [x] `cn-relay` `/healthz` を DB到達性のみの判定から拡張し、relay 依存（gossip 参加状態・topic購読同期状態）の劣化を `degraded` / `unavailable` で返すように実装
- [x] `cn-relay` `/healthz` 契約テストを拡張し、`gossip未参加 -> unavailable` と `topic同期ドリフト -> degraded` を固定
- [x] `community_nodes_roadmap.md` の該当未実装項目を `[x]` に更新
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-13_cn_relay_healthz_ready_dependency_status.md` を作成

## 検証

- [x] `./scripts/test-docker.ps1 rust`
  - ログ: `tmp/logs/test-docker-rust-relay-healthz-20260213-050522.log`
- [x] `docker run --rm --network host -v ${PWD}:/workspace ... kukuri-test-runner bash -lc "source /usr/local/cargo/env && cd /workspace/kukuri-community-node && cargo test -p cn-relay --all-features -- --nocapture"`（成功）
  - ログ: `tmp/logs/cn-relay-healthz-contract-mounted-20260213-051222.log`
- [x] `gh act --workflows .github/workflows/test.yml --job format-check --env NPM_CONFIG_PREFIX=/tmp/npm-global`（成功）
  - ログ: `tmp/logs/gh-act-format-check-relay-healthz-20260213-051312.log`
- [x] `gh act --workflows .github/workflows/test.yml --job native-test-linux --env NPM_CONFIG_PREFIX=/tmp/npm-global`（成功）
  - ログ: `tmp/logs/gh-act-native-test-linux-relay-healthz-20260213-051312.log`
- [x] `gh act --workflows .github/workflows/test.yml --job community-node-tests --env NPM_CONFIG_PREFIX=/tmp/npm-global`（成功）
  - ログ: `tmp/logs/gh-act-community-node-tests-relay-healthz-20260213-051312.log`

## Community Nodes / `cn-relay` REQ 制約（`#t` 必須・filter上限・limit上限）テスト互換固定

- [x] `cn-relay` `filters.rs` に REQ 制約の単体テストを追加し、拒否理由 `missing #t filter` / `too many filters` / `too many filter values` の互換を固定
- [x] `limit` 上限（`MAX_LIMIT`）のクランプ挙動を単体テストで固定
- [x] `community_nodes_roadmap.md` の該当未実装項目を `[x]` に更新
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-13_cn_relay_req_filter_constraints_tests.md` を作成

## 検証（REQ 制約テスト互換固定）

- [x] `./scripts/test-docker.ps1 rust`
  - ログ: `tmp/logs/test-docker-rust-cn-relay-filters-20260213-060257.log`
- [x] `docker run --rm --network kukuri_community-node-network -v ${PWD}:/workspace ... kukuri-test-runner bash -lc "source /usr/local/cargo/env && cd /workspace/kukuri-community-node && cargo test --workspace --all-features && cargo build --release -p cn-cli"`（成功）
  - 備考: 初回は DB 未接続で `PoolTimedOut`。`community-node-postgres` / `community-node-meilisearch` を起動後に再実行して成功
- [x] `docker run --rm -v ${PWD}:/workspace ... kukuri-test-runner bash -lc "source /usr/local/cargo/env && cd /workspace/kukuri-community-node && cargo test -p cn-relay filters::tests -- --nocapture"`（成功）
  - ログ: `tmp/logs/cn-relay-filters-unit-20260213-060159.log`
- [x] `gh act --workflows .github/workflows/test.yml --job format-check`（成功）
  - ログ: `tmp/logs/gh-act-format-check-cn-relay-filters-20260213-054917.log`
- [x] `gh act --workflows .github/workflows/test.yml --job native-test-linux`（成功、既知の `useRouter` 警告のみ）
  - ログ: `tmp/logs/gh-act-native-test-linux-cn-relay-filters-20260213-055036.log`
- [x] `gh act --workflows .github/workflows/test.yml --job community-node-tests`（成功）
  - ログ: `tmp/logs/gh-act-community-node-tests-cn-relay-filters-20260213-055724.log`
