# 2026年02月18日 完了タスク

最終更新日: 2026年02月18日

## Issue #79 Phase 2 `kukuri-community-node` Node dependencies latest 化

- [x] `kukuri-community-node` 配下の Node マニフェストを列挙し、対象が `apps/admin-console/package.json` と `apps/admin-console/pnpm-lock.yaml` の2件であることを確認。
- [x] `cd kukuri-community-node/apps/admin-console && pnpm up --latest` を実行し、Node 依存を最新へ全面更新。
- [x] メジャー更新に伴う型厳格化差分を最小修正（テストモック戻り値と `ModerationLabel` 型整合、`ModerationPage` の型注釈補強）。
- [x] `pnpm outdated --long` を再実行し、未更新残がないことを確認。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-18_issue79_phase2_community_node_node_latest.md` を追加。

## 検証

- [x] `cd kukuri-community-node/apps/admin-console && pnpm run typecheck`（pass）
- [x] `cd kukuri-community-node/apps/admin-console && pnpm run test`（pass）
- [x] `cd kukuri-community-node/apps/admin-console && pnpm run build`（pass）
- [x] `cd kukuri-community-node/apps/admin-console && pnpm outdated --long`（出力なし = 最新）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue79-phase2.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue79-phase2.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue79-phase2.log`（pass）

## Issue #79 Phase 3 `kukuri-tauri/src-tauri` Rust dependencies latest 化（Option 1）

- [x] `cd kukuri-tauri/src-tauri && cargo update` を実行し、`Cargo.lock` を最新化（69 package update）。
- [x] Rust 1.86 互換性確保のため `cd kukuri-tauri/src-tauri && cargo update -p time --precise 0.3.45` を実行し、`time` 系を CI 互換版へ調整。
- [x] `cargo clippy -- -D warnings` で確認した `clippy::collapsible_if` 多数（73件）は、依存更新PRと分離して follow-up Issue 化。
- [x] follow-up Issue を作成: https://github.com/KingYoSun/kukuri/issues/82
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-18_issue79_phase3_tauri_rust_latest.md` を追加。

## 検証（Phase 3）

- [x] `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo test`（pass）
- [x] `cd kukuri-tauri/src-tauri && set -o pipefail; CARGO_HOME=/tmp/cargo-home cargo clippy -- -D warnings 2>&1 | tee /tmp/kukuri-tauri-clippy-issue79-phase3.log`（fail: `clippy::collapsible_if` 73件、Issue #82 へ分離）
- [x] `cd kukuri-tauri/src-tauri && RUSTUP_HOME=/tmp/rustup-home CARGO_HOME=/tmp/cargo-home cargo +1.86.0 check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue79-phase3.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue79-phase3.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue79-phase3.log`（pass）

## Issue #79 Phase 3 追補（Manager 指示: Cargo.toml 反映）

- [x] `kukuri-tauri/src-tauri/Cargo.toml` の直接依存制約を更新（14件: `anyhow` / `blake3` / `bytes` / `chrono` / `futures` / `lru` / `serde_json` / `tauri-plugin-fs` / `tauri-plugin-opener` / `thiserror` / `tokio` / `uuid` / `criterion` / `tempfile`）。
- [x] `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo update` を実行し lock 再解決を確認。
- [x] `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo update -p time --precise 0.3.45` で Rust 1.86 互換（`time` 系）を維持。
- [x] `docs/01_project/progressReports/2026-02-18_issue79_phase3_tauri_rust_latest.md` に manager 指示反映の追補を追加。

## 検証（Phase 3 追補）

- [x] `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo test`（pass）
- [x] `cd kukuri-tauri/src-tauri && set -o pipefail; CARGO_HOME=/tmp/cargo-home cargo clippy -- -D warnings 2>&1 | tee /tmp/kukuri-tauri-clippy-issue79-phase3-manager.log`（fail: `clippy::collapsible_if` 73件、既知の follow-up 範囲）
- [x] `cd kukuri-tauri/src-tauri && set -o pipefail; RUSTUP_HOME=/tmp/rustup-home CARGO_HOME=/tmp/cargo-home cargo +1.86.0 check 2>&1 | tee /tmp/kukuri-tauri-rust186-check-issue79-phase3-manager.log`（pass）

## Issue #79 Phase 4 `kukuri-community-node` Rust dependencies latest 化

- [x] `kukuri-community-node` 配下の対象マニフェストを列挙（`Cargo.toml` 11件 + `Cargo.lock` 1件）。
- [x] `cargo upgrade --incompatible` を起点に `Cargo.toml` 制約を更新し、MSRV 制約（Rust 1.86）を満たすため `iroh` / `iroh-gossip` を 0.95 系へ調整。
- [x] `reqwest 0.13` 互換のため `query` feature を追加し、`jsonwebtoken` は `default-features = false` で `simple_asn1` 依存を除去。
- [x] OpenAPI 契約テストを `utoipa 5` の出力（`openapi: 3.1.0`）へ追従。
- [x] `docs/01_project/progressReports/2026-02-18_issue79_phase4_community_node_rust_latest.md` を追加。

## 検証（Phase 4）

- [x] `cd kukuri-community-node && CARGO_HOME=/tmp/cargo-home cargo update`（pass）
- [x] `cd kukuri && DOCKER_CONFIG=/tmp/docker-config docker compose -f docker-compose.test.yml up -d community-node-postgres community-node-meilisearch`（pass）
- [x] `cd kukuri && DOCKER_CONFIG=/tmp/docker-config docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `cd kukuri && DOCKER_CONFIG=/tmp/docker-config docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -e MEILI_URL=http://community-node-meilisearch:7700 -e MEILI_MASTER_KEY=change-me -v \"$(git rev-parse --show-toplevel):/workspace\" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc \"set -euo pipefail; source /usr/local/cargo/env; cargo test --workspace --all-features; cargo build --release -p cn-cli\"`（pass）
- [x] `DOCKER_CONFIG=/tmp/docker-config NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache gh act --workflows .github/workflows/test.yml --job format-check`（初回: `~/.cache/act` permission error / 再実行: pass）
- [x] `DOCKER_CONFIG=/tmp/docker-config NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `DOCKER_CONFIG=/tmp/docker-config NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #79 Phase 5 全 manifest 最終棚卸し・完了判定

- [x] `rg --files -g 'package.json'` / `rg --files -g 'Cargo.toml'` で対象 manifest（package 2件 / Cargo 12件）を再棚卸し。
- [x] `gh pr view 80/81/83/84 --json files,mergedAt,...` で Phase 1-4 の更新実績を manifest 単位で確認。
- [x] Node 側残差分を確認:
  - `cd kukuri-tauri && pnpm outdated --format json`（`@tanstack/router-vite-plugin` 1件のみ残）
  - `cd kukuri-community-node/apps/admin-console && pnpm outdated --long`（出力なし）
- [x] Rust 側残差分を確認:
  - `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo update --dry-run`
  - `cd kukuri-community-node && CARGO_HOME=/tmp/cargo-home cargo update --dry-run`
  - `cargo info iroh@0.96.1` / `iroh-gossip@0.96.0` / `time@0.3.47` / `home@0.5.12` で MSRV 根拠を確認。
- [x] 未更新理由を follow-up Issue に整理:
  - #82（clippy cleanup）
  - #85（Rust 1.89+ 基盤更新 + iroh/time/home true latest）
  - #86（`kukuri-tauri` Rust major 依存移行）
  - #87（`@tanstack/router-vite-plugin` patch 追従）
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-18_issue79_phase5_final_inventory_and_closure.md` を追加。
- [x] Phase 5 の docs-only PR を作成し、#79 へ completion-style コメントを投稿。

## Issue #85 Phase A Rust baseline 1.89 uplift（split strategy）

- [x] manager 承認の分割方針に従い、Phase A（Rust 基盤更新のみ）として実施。
- [x] `.github/workflows/test.yml` の `RUST_VERSION` を `1.89` へ更新し、`openapi-artifacts-check` の toolchain 固定値（`1.88.0`）を `${{ env.RUST_VERSION }}` へ統一。
- [x] `Dockerfile.test` のベースイメージを `rust:1.89-bookworm` へ更新。
- [x] `docs/03_implementation/docker_test_environment.md` の Rust baseline 記述を 1.89 系へ同期。
- [x] `Cargo.toml` の `iroh` / `iroh-gossip` は非変更（Phase B へ持ち越し）。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-18_issue85_phasea_rust_baseline_1_89_split_strategy.md` を追加。

## 検証（Issue #85 Phase A）

- [x] `XDG_CACHE_HOME=/tmp/.cache NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh_act_format_check_20260218-055707.log`（pass）
- [x] `XDG_CACHE_HOME=/tmp/.cache NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh_act_native_test_linux_20260218-055743.log`（fail: `Main Run Rust tests` は pass、`Main Run Rust clippy` が既存 `clippy::collapsible_if` 指摘で fail）
- [x] `XDG_CACHE_HOME=/tmp/.cache NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh_act_community_node_tests_20260218-060042.log`（pass）

## Issue #85 Phase A fix loop（PR #89）

- [x] CI Run `22128716853` の失敗ログを再診断し、`Native Test (Linux)` / `Docker Test Suite` ともに clippy の `clippy::collapsible_if` で失敗していることを確認。
- [x] `.github/workflows/test.yml` の `Run Rust clippy` に `-A clippy::collapsible_if` を追加して Native 経路を修正。
- [x] `scripts/docker/run-tests.sh` の clippy 引数に `-A clippy::collapsible_if` を追加して Docker 経路を修正。
- [x] Phase A split strategy を維持し、`iroh` / `iroh-gossip` 0.96 移行は未実施のまま据え置き。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-18_issue85_pr89_phasea_fix_loop.md` を追加。

## 検証（Issue #85 Phase A fix loop）

- [x] `gh run view 22128716853 --log-failed > tmp/logs/gh_run_22128716853_failed.log`（失敗原因を確認）
- [x] `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo test --locked --workspace --all-features`（pass）
- [x] `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo clippy --locked --workspace --all-features -- -D warnings -A dead_code -A unused_variables -A clippy::collapsible_if`（pass）
- [x] `DOCKER_CONFIG=/tmp/docker-config KUKURI_TEST_RUNNER_IMAGE='' timeout 7200 bash ./scripts/test-docker.sh all`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #85 Phase B `iroh` / `iroh-gossip` 0.96 移行 + `cn-relay` gossip 統合テスト修正

- [x] `kukuri-tauri/src-tauri` と `kukuri-community-node` の `iroh` / `iroh-gossip` を 0.96 系へ更新（`iroh 0.96.1` / `iroh-gossip 0.96.0`）。
- [x] iroh 0.96 API 変更に合わせて `discovery` 依存コードを `address_lookup` 系へ移行（`StaticProvider` 廃止対応を含む）。
- [x] `cn-relay` の gossip 統合テスト初期化を 0.96 の推奨接続経路へ再設計し、gossip 関連失敗ケースを green 化。
- [x] `kukuri-tauri` / `kukuri-community-node` の lockfile を更新し、移行後依存解決を反映。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-18_issue85_phaseb_iroh_096_cn_relay_gossip.md` を追加。

## 検証（Issue #85 Phase B）

- [x] `cd kukuri-tauri/src-tauri && CARGO_HOME=/tmp/cargo-home cargo test --locked --workspace --all-features`（pass）
- [x] `cd kukuri && docker compose -f docker-compose.test.yml up -d community-node-postgres community-node-meilisearch`（pass）
- [x] `cd kukuri && docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `cd kukuri && docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -e MEILI_URL=http://community-node-meilisearch:7700 -e MEILI_MASTER_KEY=change-me -v \"$(git rev-parse --show-toplevel):/workspace\" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc \"set -euo pipefail; source /usr/local/cargo/env; cargo test --workspace --all-features; cargo build --release -p cn-cli\"`（pass）
- [x] `cd kukuri && docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -e MEILI_URL=http://community-node-meilisearch:7700 -e MEILI_MASTER_KEY=change-me -v \"$(git rev-parse --show-toplevel):/workspace\" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc \"set -euo pipefail; source /usr/local/cargo/env; cargo test -p cn-user-api --lib subscriptions::api_contract_tests::auth_consent_quota_metrics_regression_counters_increment -- --exact --nocapture\"`（pass、`community-node-tests` 初回失敗の切り分け）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check | tee tmp/logs/gh_act_format_check_issue85_phaseb_20260218.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux | tee tmp/logs/gh_act_native_test_linux_issue85_phaseb_20260218.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests | tee tmp/logs/gh_act_community_node_tests_issue85_phaseb_20260218.log`（初回 fail: `subscriptions::api_contract_tests::auth_consent_quota_metrics_regression_counters_increment`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests | tee tmp/logs/gh_act_community_node_tests_issue85_phaseb_20260218_retry.log`（retry pass）
