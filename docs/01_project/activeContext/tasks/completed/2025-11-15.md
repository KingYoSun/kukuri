## 作業名: トレンド/フォロー導線 Stage4 仕上げ（メトリクス + テレメトリ）
- [x] `trending_metrics_job` の実行ログと Prometheus メトリクスへ `window_start_ms` / `window_end_ms` / `lag_ms` / `score_weight_*` を出力し、`TrendingMetricsRunStats` を拡張。`p2p_metrics_export` も `generated_at_ms=window_end` と `collected_at_ms` を明示する JSON を生成するよう修正し、Nightly/Runbook でラグを追跡できるようにした。  
- [x] `scripts/test-docker.{sh,ps1} ts --scenario trending-feed` に `scripts/metrics/export-p2p.{sh,ps1} --job trending --pretty` を組み込み、Vitest レポート（`test-results/trending-feed/reports/*.json`）、Prometheus ログ（`test-results/trending-feed/prometheus/*.log`）、JSON スナップショット（`test-results/trending-feed/metrics/*.json`）を同時に採取。`nightly.yml` へ `trending-metrics-json` artefact を追加。  
- [x] `TrendingSummaryPanel` / `FollowingSummaryPanel` に `generated_at` ラグ表示・プレビュー更新カード・DM 会話ラベルを追加し、`useDirectMessageBadge` から `latestConversationNpub` を提供。Nightly/Runbook ドキュメント（`phase5_user_flow_summary.md` / `phase5_user_flow_inventory.md` / `phase5_ci_path_audit.md` / `docs/03_implementation/trending_metrics_job.md` / `docker_test_environment.md` / `windows_test_docker_runbook.md` / `roadmap.md` / `tauri_app_implementation_plan.md`）とタスク管理ファイルを更新。  
- [x] `tasks/status/in_progress.md` からタスク10を削除し、本ファイルに完了ログを記載。

### 成果物
- `kukuri-tauri/src-tauri/src/infrastructure/jobs/trending_metrics_job.rs`
- `kukuri-tauri/src-tauri/src/infrastructure/jobs/trending_metrics_metrics.rs`
- `kukuri-tauri/src-tauri/src/bin/p2p_metrics_export.rs`
- `kukuri-tauri/src/components/trending/TrendingSummaryPanel.tsx`
- `kukuri-tauri/src/components/following/FollowingSummaryPanel.tsx`
- `scripts/test-docker.sh`
- `scripts/test-docker.ps1`
- `scripts/metrics/export-p2p.ps1`
- `docs/01_project/activeContext/tasks/status/in_progress.md`
- `docs/01_project/roadmap.md`
- `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_summary.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md`
- `docs/01_project/activeContext/tauri_app_implementation_plan.md`
- `docs/03_implementation/trending_metrics_job.md`
- `docs/03_implementation/docker_test_environment.md`
- `docs/03_implementation/windows_test_docker_runbook.md`

### 検証
- `powershell.exe -File scripts/test-docker.ps1 ts -Scenario trending-feed -NoBuild`  
- `pnpm vitest run src/tests/unit/components/trending/TrendingSummaryPanel.test.tsx src/tests/unit/components/following/FollowingSummaryPanel.test.tsx`

## 作業名: Direct Message Inbox 多端末既読共有と contract テスト
- [x] `scripts/test-docker.{sh,ps1}` に `direct-message` シナリオを追加し、`Header`/`DirectMessageInbox`/`DirectMessageDialog`/`useDirectMessageBadge` のユニットテストを Docker で一括実行できるようにした。  
- [x] `./scripts/test-docker.ps1 ts -Scenario direct-message -NoBuild` を実行し、`tmp/logs/vitest_direct_message_20251115-074009.log` と `test-results/direct-message/20251115-074009-*.json` を採取。Nightly artefact から DM 導線の回帰ログと JSON を参照可能にした。  
- [x] `./scripts/test-docker.ps1 rust -NoBuild | Tee-Object tmp/logs/rust_docker_20251115-074043.log` で `tests/contract/direct_messages.rs::direct_message_read_receipts_sync_across_devices` を再実行し、多端末既読共有ダイアログを Docker 上で検証した。  
- [x] `phase5_user_flow_inventory.md` 5.12 と `phase5_ci_path_audit.md` に `direct-message` シナリオ／artefact／ログパス（`tmp/logs/vitest_direct_message_<timestamp>.log`、`test-results/direct-message/*.json`、`tmp/logs/rust_docker_<timestamp>.log`）を追記し、Nightly から辿れるようにした。  
- [x] `tasks/status/in_progress.md` からタスク11を削除し、本ファイルに完了ログを追加。

### 成果物
- `scripts/test-docker.sh`
- `scripts/test-docker.ps1`
- `tmp/logs/vitest_direct_message_20251115-074009.log`
- `tmp/logs/rust_docker_20251115-074043.log`
- `test-results/direct-message/20251115-074009-*.json`
- `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 検証
- `powershell.exe -File scripts/test-docker.ps1 ts -Scenario direct-message -NoBuild`
- `powershell.exe -File scripts/test-docker.ps1 rust -NoBuild | Tee-Object tmp/logs/rust_docker_20251115-074043.log`

## 作業名: ユーザー検索導線 Nightly/テレメトリ整備
- [x] `.github/workflows/nightly.yml` の `nightly.user-search-pagination` ジョブを更新し、`./scripts/test-docker.sh ts --scenario user-search-pagination --no-build` を呼び出して `user-search-pagination-logs`（`tmp/logs/*.log`）、`user-search-pagination-log-archive`（`test-results/user-search-pagination/logs/*.log`）、`user-search-pagination-reports`（`test-results/user-search-pagination/reports/*.json`）を artefact 化。  
- [x] `scripts/test-docker.sh` / `scripts/test-docker.ps1` の `user-search-pagination` シナリオで `test-results/user-search-pagination/{logs,reports}` を生成し、Nightly と Runbook が `tmp` ログとアーカイブを区別して参照できるようにした。  
- [x] `/search` ルートで SearchBar がレートリミット残り秒数と `allow_incomplete` 警告を表示し、`errorHandler.info('UserSearch.rate_limited' / 'UserSearch.allow_incomplete_enabled')` でテレメトリへ記録するよう `routes/search.tsx` / `UserSearchResults.tsx` / `UserSearchResults.test.tsx` を更新。  
- [x] `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md` 5.8 と `docs/03_implementation/p2p_mainline_runbook.md` 6.4 に新しい Nightly 手順・artefact 名・ログパス（`test-results/user-search-pagination/logs/<timestamp>.log`）を追記し、`tasks/status/in_progress.md` からタスク12を削除、本ファイルへ完了記録を追加。

### 成果物
- `.github/workflows/nightly.yml`
- `scripts/test-docker.sh`
- `scripts/test-docker.ps1`
- `kukuri-tauri/src/routes/search.tsx`
- `kukuri-tauri/src/components/search/UserSearchResults.tsx`
- `kukuri-tauri/src/tests/unit/components/search/UserSearchResults.test.tsx`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md`
- `docs/03_implementation/p2p_mainline_runbook.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 検証
- `powershell.exe -File scripts/test-docker.ps1 ts -Scenario user-search-pagination -NoBuild` （`tmp/logs/user_search_pagination_20251115-135928.log`, `test-results/user-search-pagination/logs/20251115-135928.log`）
