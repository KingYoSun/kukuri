# 2025年11月12日 完了タスク

最終更新日: 2025年11月12日

## Nightly Docker シナリオ（ts-test-entrypoint）実行権限修正

- [x] `gh run list --workflow nightly.yml` / `gh run view 19269754542 --job 55094644156` で Nightly `profile-avatar-sync` / `trending-feed` ジョブが `scripts/docker/ts-test-entrypoint.sh` 実行時に `permission denied` で失敗していることを確認し、`gh api repos/KingYoSun/kukuri/actions/jobs/55094644156/logs` から OCI runtime エラーを取得。
- [x] `git update-index --chmod=+x scripts/docker/ts-test-entrypoint.sh` を適用し、Linux runner で `ts-test` サービスの entrypoint に実行権限が付与されるよう修正。
- [x] `gh act -W .github/workflows/nightly.yml -j profile-avatar-sync -P ubuntu-latest=catthehacker/ubuntu:act-latest` で Docker シナリオをローカル再現し、コンテナ起動〜Vitest 実行まで完了すること（`act` では artefact ステップのみログ検出できず失敗する制限がある）を確認。
- [x] `cd kukuri-tauri/src-tauri && cargo test` および `cd kukuri-cli && cargo test` で Rust 側回帰が無いことを検証。

### 実行コマンド

- `gh run list --workflow nightly.yml --limit 5`
- `gh run view 19269754542 --job 55094644156`
- `gh api repos/KingYoSun/kukuri/actions/jobs/55094644156/logs > tmp/gha-logs/profile-avatar-sync.log`
- `gh api repos/KingYoSun/kukuri/actions/jobs/55094644159/logs > tmp/gha-logs/trending-feed.log`
- `gh act -W .github/workflows/nightly.yml -j profile-avatar-sync -P ubuntu-latest=catthehacker/ubuntu:act-latest`
- `cd kukuri-tauri/src-tauri && cargo test`
- `cd kukuri-cli && cargo test`

## Mainline DHT Runbook / ブートストラップ動的更新 PoC

- [x] `docs/03_implementation/p2p_mainline_runbook.md` Chapter10 に CLI ブートストラップリストの既定保存先表と Ops/Nightly 連携節（10.4）を追加し、`apply_cli_bootstrap_nodes` PoC のログ要件（`tmp/logs/relay_status_cli_bootstrap_<timestamp>.log`）と `phase5_ci_path_audit.md` の参照位置を明文化。
- [x] `tmp/logs/relay_status_cli_bootstrap_20251112-094500.log` を採取し、`phase5_ci_path_audit.md`・`phase5_user_flow_summary.md`・`phase5_user_flow_inventory.md`・`phase5_dependency_inventory_template.md` と `docs/01_project/roadmap.md`（MVPトラック／KPI／Week2補足）へ PoC 完了の証跡を反映。`design_doc.md` / `refactoring_plan_2025-08-08_v3.md` の Phase5 ステータスも Runbook 完了ベースへ更新。
- [x] `pnpm install`（PowerShell, CI=true）で `node_modules/.bin/vitest` を再構築した上で `pnpm exec vitest run src/tests/unit/components/RelayStatus.test.tsx` を実行し、UI から Runbook のリンク／CLI 適用ボタンが回帰していないことを確認。Rust 側は `cargo test`（`kukuri-tauri/src-tauri`, `kukuri-cli`）を完走させ PoC に伴うコード部分の回帰が無いことを確認。

### 実行コマンド

- `cd kukuri-tauri/src-tauri && cargo test`
- `cd kukuri-cli && cargo test`
- `cd kukuri-tauri && powershell -Command "pnpm install"`
- `cd kukuri-tauri && powershell -Command "pnpm exec vitest run src/tests/unit/components/RelayStatus.test.tsx"`
