# 2026年01月22日 完了タスク

最終更新日: 2026年01月23日

## コミュニティノード実装計画ドキュメント作成

- [x] `docs/01_project/activeContext/community_node_plan.md` をベースに、コミュニティノードの実装計画を `docs/03_implementation/community_nodes/` 配下へサービス別に分割して作成。
- [x] 管理画面（React/TS/Vite/shadcn/ui/zod/zustand/TanStack）と Docker Compose profiles、Postgres+Apache AGE、Meilisearch、LLM moderation（OpenAI/self-host）を前提にした設計へ拡張。
- [x] `docs/03_implementation/summary.md` にコミュニティノード実装計画の導線を追加。
- [x] 外部I/Fを User API に集約し、topic購読（ユーザー購読/ノード取込購読）と relay 必須の取込パイプライン方針を追記。
- [x] 利用規約/プライバシーポリシーの管理（Admin Console）と同意必須化（User API）を設計に追記。
- [x] relay/bootstrap の認証をデフォルトOFFとし、管理画面から後から認証必須化できる方針を追記。
- [x] relay/bootstrap は認証OFFの間は同意不要（ユーザー操作の手間最小化）とし、認証必須化した場合に同意チェックを有効化できる方針を追記。
- [x] relay の取込/再配信を iroh-gossip に統一し、gossip 由来イベントの重複配送を `event.id` で冪等処理する方針を追記（アプリケーションは同一 topic に再注入しない）。
- [x] outbox/NOTIFY の配信セマンティクス（at-least-once/offset/リプレイ/バックプレッシャ）を整理し、各サービス（relay/index/moderation/trust）・購読設計へ反映。
- [x] KIP-0001 Access Control（39020/39021、P2P join、epochローテ/追放）の v1 方針を整理し、設計へ反映。
- [x] relay/bootstrap の認証OFF→ON 切替（既存接続の扱い、猶予期間、互換性）の v1 方針を整理し、各サービス設計と同意設計へ反映。
- [x] 課金/利用量計測（課金単位、無料枠/上限、超過時挙動、監査）の v1 方針を整理し、User API / 購読設計 / 管理画面へ反映。
- [x] LLM moderation の送信/保存/開示ポリシー（外部送信範囲、ログ/保持、コスト上限、Privacy への記載）の v1 方針を整理し、moderation設計/規約設計/管理画面へ反映。
- [x] 運用要件（監視/メトリクス/ログ、バックアップ/リストア、マイグレーション、違法/通報対応 Runbook）の v1 方針を整理し、サービス設計/Compose設計へ反映。
- [x] 個人データの取扱い（保持期間、削除/エクスポート要求、同意ログの扱い）の v1 方針を整理し、User API / 同意設計 / 課金設計 / 運用Runbook へ反映。

### 追加ファイル

- `docs/03_implementation/community_nodes/summary.md`
- `docs/03_implementation/community_nodes/architecture_overview.md`
- `docs/03_implementation/community_nodes/repository_structure.md`
- `docs/03_implementation/community_nodes/docker_compose_profiles.md`
- `docs/03_implementation/community_nodes/admin_console.md`
- `docs/03_implementation/community_nodes/postgres_age_design.md`
- `docs/03_implementation/community_nodes/services_bootstrap.md`
- `docs/03_implementation/community_nodes/services_relay.md`
- `docs/03_implementation/community_nodes/services_index.md`
- `docs/03_implementation/community_nodes/services_moderation.md`
- `docs/03_implementation/community_nodes/services_trust.md`
- `docs/03_implementation/community_nodes/cn_cli_migration.md`
- `docs/03_implementation/community_nodes/user_api.md`
- `docs/03_implementation/community_nodes/topic_subscription_design.md`
- `docs/03_implementation/community_nodes/policy_consent_management.md`
- `docs/03_implementation/community_nodes/outbox_notify_semantics.md`
- `docs/03_implementation/community_nodes/access_control_design.md`
- `docs/03_implementation/community_nodes/auth_transition_design.md`
- `docs/03_implementation/community_nodes/billing_usage_metering.md`
- `docs/03_implementation/community_nodes/llm_moderation_policy.md`
- `docs/03_implementation/community_nodes/ops_runbook.md`
- `docs/03_implementation/community_nodes/personal_data_handling_policy.md`

### 検証

- 本セッションではユーザー指示により `gh act` などの検証は未実行。
