# 2026年02月19日 完了タスク

最終更新日: 2026年02月19日

## Issue #107 Meilisearch 依存の完全撤去（PG-only 経路）

- [x] `cn-core` / `cn-user-api` / `cn-index` / `cn-cli` から Meilisearch runtime 依存を削除し、PG-only 経路へ統一。
- [x] compose / workflow / test scripts から `community-node-meilisearch` と `MEILI_*` 依存を除去。
- [x] docs / README / AGENTS の実行手順を postgres-only 構成に更新。
- [x] runtime flags 既定値を `search_read_backend=pg` / `search_write_mode=pg_only` に固定し、移行用 migration（`m13`）を追加。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-19_issue107_remove_meilisearch_dependency.md` を追加。

## Issue #107 PR #108 レビュー指摘対応（Codex Review follow-up）

- [x] `cn-user-api/src/subscriptions.rs` の `#[cfg(any())]` を廃止し、`api_contract_tests` を PG-only 経路に合わせて復旧（`/v1/search` 契約テストを再有効化）。
- [x] `cn-index/src/integration_tests.rs` を復元し、PG-only の outbox / reindex / backfill / healthz / metrics 回帰を検証する統合テストへ再構成。
- [x] `cn-index/src/lib.rs` に `#[cfg(test)] mod integration_tests;` を再追加し、統合テストが CI で常時実行される状態へ戻した。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-19_issue107_pr108_review_fixes.md` を追加。

## 検証

- [x] `DOCKER_CONFIG=/tmp/docker-config docker compose -f docker-compose.test.yml up -d community-node-postgres`（pass）
- [x] `DOCKER_CONFIG=/tmp/docker-config docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `DOCKER_CONFIG=/tmp/docker-config docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -v "$(git rev-parse --show-toplevel):/workspace" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc "set -euo pipefail; source /usr/local/cargo/env; cargo test --workspace --all-features; cargo build --release -p cn-cli"`（pass）
- [x] `DOCKER_CONFIG=/tmp/docker-config docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -v "$(git rev-parse --show-toplevel):/workspace" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc "set -euo pipefail; source /usr/local/cargo/env; cargo test -p cn-user-api subscriptions::api_contract_tests -- --nocapture; cargo test -p cn-index -- --nocapture"`（pass）
- [x] `cd kukuri-community-node && cargo fmt --all`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check`（初回 fail: Rust fmt diff / 再実行 pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）
