# 2026年01月28日 完了

完了日: 2026年01月28日

## GitHub Actions 失敗修正（desktop-e2e / community node）

- [x] cn-core の Meilisearch クライアントに Authorization(Bearer) ヘッダを追加
- [x] gh run view で失敗ログを確認し、gh act で desktop-e2e を再現
- [x] `./scripts/test-docker.ps1 e2e-community-node` で再実行して通過

### 検証

- `./scripts/test-docker.ps1 e2e-community-node`
- `gh act --workflows .github/workflows/test.yml --job format-check`（警告: git clone の some refs were not updated、pnpm fetch 500 のリトライ）
- `gh act --workflows .github/workflows/test.yml --job native-test-linux`（警告: git clone の some refs were not updated、Vitest の act() 警告）

## Community Node 実ノード認証フローE2E

- [x] 実ノード challenge/verify を通す E2E ブリッジヘルパーを追加し、設定/認証/同意取得を一括で実行できるようにした
- [x] `community-node.settings.spec.ts` から認証ヘルパーを利用し、実ノードの設定/認証/同意取得を再実行
- [x] 実ノード E2E を `./scripts/test-docker.ps1 e2e-community-node` で再実行して通過

### 検証

- `./scripts/test-docker.ps1 e2e-community-node`
- `gh act --workflows .github/workflows/test.yml --job format-check`
- `gh act --workflows .github/workflows/test.yml --job native-test-linux`

## Community Node 招待/鍵同期/暗号化投稿E2E

- [x] `cn-cli` に invite.capability 発行ヘルパーを追加し、実ノード向けに招待 JSON を生成できるようにした
- [x] 招待適用→鍵同期→invite scope 暗号化投稿の E2E を追加し、scope/暗号化バッジを検証するように更新
- [x] `./scripts/test-docker.ps1 e2e-community-node` を再実行して通過
- 注記: 本E2Eは実ノード/CLIヘルパーによる legacy。v1 は P2P-only のため、`access_control_issue_invite`/`access_control_request_join` の E2E へ移行する。

### 検証

- `./scripts/test-docker.ps1 e2e-community-node`

## Community Node Access Control P2P-only 再編

- [x] KIP-0001 に `join.request(39022)` を追加し、v1 を P2P-only として再定義
- [x] `access_control_design.md` を P2P join/鍵配布/ローテ中心に再編し、User API 依存を削除
- [x] 関連設計（community_node_plan/user_api/topic_subscription/services_relay/event_treatment/summary 等）を P2P-only 方針に合わせて整合

## P2P join フロー実装/kip types/テスト文言整理

- [x] cn-kip-types に join.request(39022) の型/検証を追加
- [x] Tauri の AccessControlService/コマンドを追加し、invite共有→join.request→key.envelope 受領を実装
- [x] AccessControlService のユニットテストを追加
- [x] E2E/テスト文言を P2P-only 方針に合わせて整理（legacy E2E 注記）

### 検証

- `./scripts/test-docker.ps1 rust`（警告: `access_control_service.rs` の unused field）
- `gh act --workflows .github/workflows/test.yml --job format-check`（警告: git clone の `some refs were not updated` / pnpm build script notice）
- `gh act --workflows .github/workflows/test.yml --job native-test-linux`（警告: unused field / React `act(...)` warning）
