# 2026年02月14日 完了タスク

最終更新日: 2026年02月14日

## Community Nodes / `cn-relay` REQ `since/until` 時間範囲制約の実装

- [x] `cn-relay` `filters.rs` に REQ 時間範囲制約（`since > until` / 過大lookback / 過大window）を実装
- [x] 拒否理由を固定（`invalid since/until range` / `lookback too large` / `time window too large`）
- [x] `filters.rs` に unit test を追加し、拒否理由互換を固定
- [x] `integration_tests.rs` に WebSocket REQ の統合テストを追加し、`NOTICE` 理由の互換を固定
- [x] `community_nodes_roadmap.md` の該当未実装項目を `[x]` に更新
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-14_cn_relay_req_time_range_constraints.md` を作成

## 検証

- [x] `./scripts/test-docker.ps1 rust`（成功）
- [x] `docker compose -f docker-compose.test.yml up -d community-node-postgres community-node-meilisearch`（成功）
- [x] `docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -e MEILI_URL=http://community-node-meilisearch:7700 -e MEILI_MASTER_KEY=change-me -v ${PWD}:/workspace -w /workspace/kukuri-community-node kukuri-test-runner bash -lc "set -euo pipefail; source /usr/local/cargo/env; cargo test --workspace --all-features; cargo build --release -p cn-cli"`（成功）
- [x] `$env:NPM_CONFIG_PREFIX='/tmp/npm-global'; gh act --workflows .github/workflows/test.yml --job format-check`
  - 初回失敗（`rustfmt` 差分）: `tmp/logs/gh-act-format-check-cn-relay-time-range-20260214.log`
  - 再実行成功: `tmp/logs/gh-act-format-check-cn-relay-time-range-20260214-final.log`
- [x] `$env:NPM_CONFIG_PREFIX='/tmp/npm-global'; gh act --workflows .github/workflows/test.yml --job native-test-linux`
  - 成功ログ: `tmp/logs/gh-act-native-test-linux-cn-relay-time-range-20260214-final.log`
- [x] `$env:NPM_CONFIG_PREFIX='/tmp/npm-global'; gh act --workflows .github/workflows/test.yml --job community-node-tests`
  - 成功ログ: `tmp/logs/gh-act-community-node-tests-cn-relay-time-range-20260214-final.log`

補足: `gh act` 実行時に PowerShell 側で `NativeCommandError` が出力されるが、各ログ末尾の `Job succeeded` で成功を確認済み。
