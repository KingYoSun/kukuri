# 2026年02月17日 完了タスク

最終更新日: 2026年02月17日

## Issue #52 Desktop E2E failure 修正（Run `22075452530` / Job `63789452806`）

- [x] `gh api repos/KingYoSun/kukuri/actions/jobs/63789452806/logs` で失敗ログを解析し、`Run community node E2E scenario` 失敗の内訳（`community-node.friend-plus` / `community-node.invite` / `direct-messages.inbox` / `sync.offline-status`）を特定。
- [x] Desktop E2E の不安定要因を最小差分で修正（i18n 依存セレクタの多言語対応、トピック遷移待機強化、`create-post-button` の test id 追加、同期キュー更新ボタンの `aria-label` 対応）。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue52_desktop_e2e_fix.md` を追加。

## 検証

- [x] `DOCKER_CONFIG=/tmp/.docker bash scripts/test-docker.sh e2e-community-node`（初回: `Spec Files: 16 passed, 1 failed`。失敗は `sync.offline-status.spec.ts` の「再送キュー更新ボタンが見つかりませんでした」）
- [x] `DOCKER_CONFIG=/tmp/.docker bash scripts/test-docker.sh e2e-community-node`（修正後再実行: `Spec Files: 17 passed, 17 total`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job format-check`（pass, ログ: `tmp/logs/gh-act-format-check-issue52.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass, ログ: `tmp/logs/gh-act-native-test-linux-issue52.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass, ログ: `tmp/logs/gh-act-community-node-tests-issue52.log`）

## Issue #52 PR #54 レビュー指摘対応（`discussion_r2815371993`）

- [x] `kukuri-tauri/tests/e2e/specs/community-node.friend-plus.spec.ts` のトピック遷移で `topicId` を `encodeURIComponent` して `pushState` / `location.replace` に反映。
- [x] 遷移確認 `waitUntil` もエンコード後URL（`/topics/${encodedTopicId}`）を基準に統一し、`/`・`?` を含む `topicId` でも経路が壊れないよう修正。
- [x] `pnpm exec eslint tests/e2e/specs/community-node.friend-plus.spec.ts`（pass）
- [x] `pnpm exec prettier --check tests/e2e/specs/community-node.friend-plus.spec.ts`（初回 fail → `pnpm exec prettier --write ...` 実施後 pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job format-check`（pass, ログ: `tmp/logs/gh-act-format-check-issue52-review-followup.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass, ログ: `tmp/logs/gh-act-native-test-linux-issue52-review-followup.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass, ログ: `tmp/logs/gh-act-community-node-tests-issue52-review-followup.log`）

## Issue #55 Heavy lane 再発修正（Run `22090400126`）

- [x] `gh run view 22090400126 --log-failed` で失敗ジョブを解析し、`Desktop E2E (Community Node, Docker)` が stale E2E spec を実行していたことを特定。
- [x] `.github/workflows/test.yml` の `desktop-e2e` で `KUKURI_TEST_RUNNER_IMAGE` を空文字へ変更し、prebuilt image ではなく checkout から image build する経路に統一。
- [x] tracking issue を新規作成（#55）し、#52 には「別根因のため reopen せず #55 で追跡」の判断をコメント。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue55_heavy_lane_stale_prebuilt_fix.md` を追加。

## 検証

- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass, ログ: `tmp/logs/gh-act-format-check-20260217-084135.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass, ログ: `tmp/logs/gh-act-native-test-linux-20260217-084202.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass, ログ: `tmp/logs/gh-act-community-node-tests-20260217-084503.log`）
- [x] `DOCKER_CONFIG=/tmp/docker-config bash scripts/test-docker.sh e2e-community-node`（pass, `Spec Files: 17 passed, 17 total`, ログ: `tmp/logs/test-docker-e2e-community-node-20260217-084758.log`）

## Issue #45 PR-2 locale drift 是正

- [x] `kukuri-tauri/src/locales/en.json` に `posts.submit` を追加し、`en` の欠落キーを解消。
- [x] `kukuri-tauri/src/locales/zh-CN.json` に `bootstrapConfig.add` / `bootstrapConfig.noNodes` を追加し、`zh-CN` の欠落キーを解消。
- [x] `scripts/check-locale-keys.mjs` を追加し、`ja/en/zh-CN` のフラットキー集合一致チェックを実装。
- [x] `kukuri-tauri/package.json` に `check:locale-keys` を追加。
- [x] `kukuri-tauri/src/tests/unit/i18n/localeKeyDrift.test.ts` を追加し、キー集合不一致をユニットテストで検知可能化。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue45_pr2_locale_drift_correction.md` を追加。

## 検証

- [x] `cd kukuri-tauri && pnpm check:locale-keys`（pass）
- [x] `cd kukuri-tauri && pnpm vitest run src/tests/unit/i18n/localeKeyDrift.test.ts`（pass）
- [x] `cd kukuri-tauri && pnpm exec prettier --check src/locales/en.json src/locales/zh-CN.json src/tests/unit/i18n/localeKeyDrift.test.ts package.json ../scripts/check-locale-keys.mjs`（pass）
- [x] `cd /tmp/kukuri-issue45-pr2 && XDG_CACHE_HOME=/tmp/xdg-cache NPM_CONFIG_PREFIX=/tmp/npm-global DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue45-pr2.log`（pass）
- [x] `cd /tmp/kukuri-issue45-pr2 && bash -lc 'set -o pipefail; XDG_CACHE_HOME=/tmp/xdg-cache NPM_CONFIG_PREFIX=/tmp/npm-global DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue45-pr2.log'`（fail: 既知要因 `app_hide.toml` 欠落。ログ: `tmp/logs/gh-act-native-test-linux-issue45-pr2.log`）
- [x] `cd /tmp/kukuri-issue45-pr2 && bash -lc 'set -o pipefail; XDG_CACHE_HOME=/tmp/xdg-cache NPM_CONFIG_PREFIX=/tmp/npm-global DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue45-pr2.log'`（pass）
