# 2026年02月17日 完了タスク

最終更新日: 2026年02月17日

## Issue #52 Desktop E2E failure 修正（Run `22075452530` / Job `63789452806`）

- [x] `gh api repos/KingYoSun/kukuri/actions/jobs/63789452806/logs` で失敗ログを解析し、`Run community node E2E scenario` 失敗の内訳（`community-node.friend-plus` / `community-node.invite` / `direct-messages.inbox` / `sync.offline-status`）を特定。
- [x] Desktop E2E の不安定要因を最小差分で修正（i18n 依存セレクタの多言語対応、トピック遷移待機強化、`create-post-button` の test id 追加、同期キュー更新ボタンの `aria-label` 対応）。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue52_desktop_e2e_fix.md` を追加。

## 検証

- [x] `DOCKER_CONFIG=/tmp/.docker bash scripts/test-docker.sh e2e-community-node`（初回: `Spec Files: 16 passed, 1 failed`。失敗は `sync.offline-status.spec.ts` の「再送キュー更新ボタンが見つかりませんでした」）
- [x] `DOCKER_CONFIG=/tmp/.docker bash scripts/test-docker.sh e2e-community-node`（修正後再実行: `Spec Files: 17 passed, 17 total`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job format-check`（pass, ログ: `tmp/logs/gh-act-format-check-issue52.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass, ログ: `tmp/logs/gh-act-native-test-linux-issue52.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass, ログ: `tmp/logs/gh-act-community-node-tests-issue52.log`）

## Issue #52 PR #54 レビュー指摘対応（`discussion_r2815371993`）

- [x] `kukuri-tauri/tests/e2e/specs/community-node.friend-plus.spec.ts` のトピック遷移で `topicId` を `encodeURIComponent` して `pushState` / `location.replace` に反映。
- [x] 遷移確認 `waitUntil` もエンコード後URL（`/topics/${encodedTopicId}`）を基準に統一し、`/`・`?` を含む `topicId` でも経路が壊れないよう修正。
- [x] `pnpm exec eslint tests/e2e/specs/community-node.friend-plus.spec.ts`（pass）
- [x] `pnpm exec prettier --check tests/e2e/specs/community-node.friend-plus.spec.ts`（初回 fail → `pnpm exec prettier --write ...` 実施後 pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job format-check`（pass, ログ: `tmp/logs/gh-act-format-check-issue52-review-followup.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass, ログ: `tmp/logs/gh-act-native-test-linux-issue52-review-followup.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass, ログ: `tmp/logs/gh-act-community-node-tests-issue52-review-followup.log`）

## Issue #55 Heavy lane 再発修正（Run `22090400126`）

- [x] `gh run view 22090400126 --log-failed` で失敗ジョブを解析し、`Desktop E2E (Community Node, Docker)` が stale E2E spec を実行していたことを特定。
- [x] `.github/workflows/test.yml` の `desktop-e2e` で `KUKURI_TEST_RUNNER_IMAGE` を空文字へ変更し、prebuilt image ではなく checkout から image build する経路に統一。
- [x] tracking issue を新規作成（#55）し、#52 には「別根因のため reopen せず #55 で追跡」の判断をコメント。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue55_heavy_lane_stale_prebuilt_fix.md` を追加。

## 検証

- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass, ログ: `tmp/logs/gh-act-format-check-20260217-084135.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass, ログ: `tmp/logs/gh-act-native-test-linux-20260217-084202.log`）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass, ログ: `tmp/logs/gh-act-community-node-tests-20260217-084503.log`）
- [x] `DOCKER_CONFIG=/tmp/docker-config bash scripts/test-docker.sh e2e-community-node`（pass, `Spec Files: 17 passed, 17 total`, ログ: `tmp/logs/test-docker-e2e-community-node-20260217-084758.log`）

## Issue #45 strict 再監査（PR #49 / #54 / #56 マージ後）

- [x] `references/community-nodes-strict-audit-checklist.md` の有無を確認し、未存在のため Issue #5 fallback gate（`https://github.com/KingYoSun/kukuri/issues/5#issuecomment-3900483686`）を適用。
- [x] `jq` + `comm` で `ja/en/zh-CN` のキー集合を比較し、`en.posts.submit` と `zh-CN.bootstrapConfig.add/noNodes` の欠落を再現確認（当時HEAD基準）。
- [x] `rg -n "toLocaleString\\(|Intl\\.DateTimeFormat\\(undefined" kukuri-tauri/src --glob '!**/tests/**'` で、時刻表示ロケール不一致の残件を再現確認。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue45_strict_reaudit_after_pr49_54_56.md` を追加。
- [x] Issue #45 に strict re-audit 結果をコメント投稿（`https://github.com/KingYoSun/kukuri/issues/45#issuecomment-3913777534`）。

## Issue #45 PR-2 locale drift 是正

- [x] `kukuri-tauri/src/locales/en.json` に `posts.submit` を追加し、`en` の欠落キーを解消。
- [x] `kukuri-tauri/src/locales/zh-CN.json` に `bootstrapConfig.add` / `bootstrapConfig.noNodes` を追加し、`zh-CN` の欠落キーを解消。
- [x] `scripts/check-locale-keys.mjs` を追加し、`ja/en/zh-CN` のフラットキー集合一致チェックを実装。
- [x] `kukuri-tauri/package.json` に `check:locale-keys` を追加。
- [x] `kukuri-tauri/src/tests/unit/i18n/localeKeyDrift.test.ts` を追加し、キー集合不一致をユニットテストで検知可能化。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue45_pr2_locale_drift_correction.md` を追加。

## 検証

- [x] `cd kukuri-tauri && pnpm check:locale-keys`（pass）
- [x] `cd kukuri-tauri && pnpm vitest run src/tests/unit/i18n/localeKeyDrift.test.ts`（pass）
- [x] `cd kukuri-tauri && pnpm exec prettier --check src/locales/en.json src/locales/zh-CN.json src/tests/unit/i18n/localeKeyDrift.test.ts package.json ../scripts/check-locale-keys.mjs`（pass）
- [x] `cd /tmp/kukuri-issue45-pr2 && XDG_CACHE_HOME=/tmp/xdg-cache NPM_CONFIG_PREFIX=/tmp/npm-global DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue45-pr2.log`（pass）
- [x] `cd /tmp/kukuri-issue45-pr2 && bash -lc 'set -o pipefail; XDG_CACHE_HOME=/tmp/xdg-cache NPM_CONFIG_PREFIX=/tmp/npm-global DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue45-pr2.log'`（fail: 既知要因 `app_hide.toml` 欠落。ログ: `tmp/logs/gh-act-native-test-linux-issue45-pr2.log`）
- [x] `cd /tmp/kukuri-issue45-pr2 && bash -lc 'set -o pipefail; XDG_CACHE_HOME=/tmp/xdg-cache NPM_CONFIG_PREFIX=/tmp/npm-global DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue45-pr2.log'`（pass）

## Issue #45 PR-3 時刻表示ロケール統一

- [x] `kukuri-tauri/src/lib/utils/localeFormat.ts` を追加し、`i18n.language` 正規化（`getCurrentLocale`）に基づく日時/数値フォーマッタを共通化。
- [x] PR-3対象9領域（`NostrTestPanel` / `DirectMessageDialog` / `DirectMessageInbox` / `PeerConnectionPanel` / `PostSearchResults` / `CommunityNodePanel` / `KeyManagementDialog` / `summaryTime` / `ConflictResolutionDialog`）の `toLocaleString` / `Intl.DateTimeFormat(undefined, ...)` を共通ヘルパーへ置換。
- [x] `kukuri-tauri/src/tests/unit/lib/localeFormat.test.ts` を追加し、i18n言語切替時のフォーマット挙動（日時・数値）と異常値フォールバックをユニットテスト化。
- [x] `rg -n "toLocaleString\\(|Intl\\.DateTimeFormat\\(undefined" kukuri-tauri/src --glob '!**/tests/**'` を再実行し、ヒット0件を確認。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-17_issue45_pr3_time_locale_unification.md` を追加。

## 検証

- [x] `cd kukuri-tauri && pnpm vitest run src/tests/unit/lib/localeFormat.test.ts src/tests/unit/components/NostrTestPanel.test.tsx src/tests/unit/components/directMessages/DirectMessageDialog.test.tsx src/tests/unit/components/directMessages/DirectMessageInbox.test.tsx src/tests/unit/components/p2p/PeerConnectionPanel.test.tsx src/tests/unit/components/search/PostSearchResults.test.tsx src/tests/unit/components/settings/CommunityNodePanel.test.tsx src/tests/unit/components/settings/KeyManagementDialog.test.tsx src/tests/unit/components/sync/ConflictResolutionDialog.test.tsx src/tests/unit/components/trending/TrendingSummaryPanel.test.tsx src/tests/unit/components/following/FollowingSummaryPanel.test.tsx`（pass）
- [x] `cd kukuri-tauri && pnpm type-check`（pass）
- [x] `cd kukuri-tauri && pnpm lint`（pass）
- [x] `cd kukuri-tauri && pnpm format:check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue45-pr3.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue45-pr3.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue45-pr3.log`（pass）

## Issue #40 M-02 admin-console package license MIT統一

- [x] `kukuri-community-node/apps/admin-console/package.json` に `"license": "MIT"` を追加し、リポジトリ方針と整合するように更新。
- [x] 変更を当該ファイルに限定し、既存フォーマット（2スペースインデント）を維持。

## 検証

- [x] `jq -r '.license' kukuri-community-node/apps/admin-console/package.json`（`MIT` を確認）
- [x] `jq empty kukuri-community-node/apps/admin-console/package.json`（JSON妥当性 pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue40-m02.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue40-m02.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue40-m02.log`（pass）

## Issue #40 M-03 kukuri-tauri package license MIT統一

- [x] `kukuri-tauri/package.json` に `"license": "MIT"` を追加し、リポジトリ方針と整合するように更新。
- [x] 変更を当該ファイルに限定し、既存フォーマット（2スペースインデント）を維持。
- [x] タスク管理文書を更新（`tasks/completed/2026-02-17.md` 追記、`tasks/status/in_progress.md` へ進捗反映）。

## 検証

- [x] `jq -r '.license' kukuri-tauri/package.json`（`MIT` を確認）
- [x] `jq empty kukuri-tauri/package.json`（JSON妥当性 pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job format-check 2>&1 | tee tmp/logs/gh-act-format-check-issue40-m03.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job native-test-linux 2>&1 | tee tmp/logs/gh-act-native-test-linux-issue40-m03.log`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global XDG_CACHE_HOME=/tmp/xdg-cache DOCKER_CONFIG=/tmp/docker-config ACT_CACHE_DIR=/tmp/act-cache gh act --workflows .github/workflows/test.yml --job community-node-tests 2>&1 | tee tmp/logs/gh-act-community-node-tests-issue40-m03.log`（pass）

## Issue #63 main CI failure hotfix（Run `22101614830`）

- [x] `gh api repos/KingYoSun/kukuri/actions/jobs/63872622145/logs` と `gh api repos/KingYoSun/kukuri/actions/jobs/63872622185/logs` で失敗ログを解析し、OpenAPI 側は `rustup toolchain install 1.88.0` の timeout、Desktop E2E 側は `Dockerfile.test` の `apt-get update` timeout に起因することを特定。
- [x] `.github/workflows/test.yml` の `openapi-artifacts-check` に Rust setup 3回目を追加し、`RUSTUP_MAX_RETRIES=10` を設定して一時的なネットワーク失敗に対する回復性を強化。
- [x] `Dockerfile.test` の APT ミラーを `https://deb.debian.org` へ統一し、`apt-get update/install` と Node.js 導入を retry 付きに変更して timeout 時の再試行を実装。
- [x] tracking issue #63 へ進捗コメントを投稿し、進捗レポート `docs/01_project/progressReports/2026-02-17_issue63_main_ci_hotfix.md` を追加。

## 検証

- [x] `DOCKER_CONFIG=/tmp/docker-config docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `RUSTUP_HOME=/tmp/rustup CARGO_HOME=/tmp/cargo-home RUSTUP_MAX_RETRIES=10 rustup toolchain install 1.88.0 --profile minimal --no-self-update`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check --action-cache-path /tmp/act-cache --cache-server-path /tmp/actcache-server`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux --action-cache-path /tmp/act-cache --cache-server-path /tmp/actcache-server`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests --action-cache-path /tmp/act-cache --cache-server-path /tmp/actcache-server`（pass）
