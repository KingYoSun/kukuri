## 作業名: グローバルコンポーザー & 投稿削除キャッシュ整合性仕上げ
- [x] `useDeletePost` / `postStore.deletePostRemote` を共通の `DeletePostRemoteInput` で接続し、オンライン/オフラインの双方で `cacheUtils.invalidatePostCaches` を呼び出すよう再実装。`removePostFromTrendingCache` / `removePostFromFollowingCache` を QueryClient 直下で利用し、`OfflineActionType::DELETE_POST` に `topicId` / `authorPubkey` を必ず含めることで再送時の整合性も確保した。  
- [x] `scripts/test-docker.ps1` の `post-delete-cache` シナリオを `run-vitest-target.sh` ベースへ移行し、`src/tests/unit/stores/postStore.test.ts` を追加で実行するように調整。`topic-create` シナリオも同じ実行フローへ合わせ、PowerShell でも `set -euo pipefail` エラーが発生しないようにした。  
- [x] `corepack enable pnpm` 後に `./scripts/test-docker.ps1 ts -Scenario post-delete-cache` / `ts -Scenario topic-create` / `ts -Scenario trending-feed` を実行し、`tmp/logs/post_delete_cache_20251116-014422.log`・`tmp/logs/topic_create_20251116-014614.log`・`tmp/logs/trending-feed/20251116-014637.log`（および `tmp/logs/trending_metrics_job_stage4_20251116-014637.log`）と各 `test-results/<scenario>/20251116-0146*.json` を Nightly artefact に更新。  
- [x] `phase5_dependency_inventory_template.md`・`phase5_user_flow_inventory.md`（Sec.5.7/5.9/5.10）・`phase5_user_flow_summary.md`・`phase5_ci_path_audit.md`・`docs/03_implementation/p2p_mainline_runbook.md` を最新ログ/シナリオ情報で更新し、`tasks/status/in_progress.md` から当該タスクを削除。  

### 成果物
- `kukuri-tauri/src/hooks/usePosts.ts`
- `kukuri-tauri/src/stores/postStore.ts`
- `kukuri-tauri/src/tests/unit/hooks/useDeletePost.test.tsx`
- `kukuri-tauri/src/tests/unit/stores/postStore.test.ts`
- `scripts/test-docker.ps1`
- `docs/01_project/activeContext/artefacts/phase5_dependency_inventory_template.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_summary.md`
- `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md`
- `docs/03_implementation/p2p_mainline_runbook.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 検証
- `corepack enable pnpm`
- `./scripts/test-docker.ps1 ts -Scenario post-delete-cache`
- `./scripts/test-docker.ps1 ts -Scenario topic-create`
- `./scripts/test-docker.ps1 ts -Scenario trending-feed`
## Ops/CI: Nightly docker シナリオの起動不能を解消
- [x] `.gitattributes` を追加し、Bash 系スクリプトを常に `eol=lf` で取得するように制御。
- [x] `scripts/test-docker.sh` 全体を LF へ戻し、`run_ts_trending_feed` / `run_ts_profile_avatar_sync` の `bash -lc "…"` 直書きを heredoc ベースのコマンド生成に置き換えて Bash パーサで解釈できるよう再構成。
- [x] `docker run --rm -v "$PWD:/work" -w /work ubuntu:24.04 bash -lc "bash -n scripts/test-docker.sh"` で構文検証し、CI 同等条件として `gh act --workflows .github/workflows/nightly.yml --job trending-feed --container-options "--privileged" -P ubuntu-latest=ghcr.io/catthehacker/ubuntu:act-latest` を実行して Docker build まで進むことを確認。

### 影響
- `.gitattributes`
- `scripts/test-docker.sh`

### 実行
- `docker run --rm -v "$PWD:/work" -w /work ubuntu:24.04 bash -lc "bash -n scripts/test-docker.sh"`
- `gh act --workflows .github/workflows/nightly.yml --job trending-feed --container-options "--privileged" -P ubuntu-latest=ghcr.io/catthehacker/ubuntu:act-latest`
