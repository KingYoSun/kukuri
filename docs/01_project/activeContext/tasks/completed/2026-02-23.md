# 2026年02月23日 完了タスク

最終更新日: 2026年02月23日

## Issue #129: プロフィール保存の永続化不具合修正

- [x] `ProfileEditDialog` / `ProfileSetup` の保存処理で、アバター以外のプロフィール項目（`name` / `displayName` / `about` / `nip05`）をローカル保存できるよう `update_user_profile` 呼び出しを追加。
- [x] Tauri 側に `UpdateUserProfileRequest` と `update_user_profile` コマンドを追加し、フロント API 型との不一致とバリデーション不整合を解消。
- [x] `get_user` / `get_user_by_pubkey` の返却型を `UserProfileDto` に統一し、フロントのプロフィール取得型と整合。
- [x] 既存のアバターアップロード・同期フローを維持しつつ、保存処理中の失敗を工程別（avatar/privacy/local/nostr/sync/init）に可視化。
- [x] 保存後に React Query キャッシュを更新・invalidate して、設定画面/プロフィール表示系の画面間反映を即時化。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-23_issue129_profile_save_persistence.md` を追加。

## 検証

- [x] `cd kukuri-tauri/src-tauri && cargo fmt`（pass）
- [x] `cd kukuri-tauri/src-tauri && cargo test`（pass）
- [x] `bash ./scripts/test-docker.sh ts --scenario profile-avatar-sync`（pass）
- [x] `bash ./scripts/test-docker.sh lint --no-build`（pass）
- [x] `docker compose -f docker-compose.test.yml up -d community-node-postgres`（pass）
- [x] `docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -v "$(git rev-parse --show-toplevel):/workspace" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc "set -euo pipefail; source /usr/local/cargo/env; cargo test --workspace --all-features; cargo build --release -p cn-cli"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）

## Issue #140: Topic timeline/thread rebuild Phase 1（Backend thread foundation）

- [x] `CreatePostRequest` / `PostResponse` を thread メタデータ（`threadUuid` / root / parent）対応に拡張し、`create_post` コマンド経路を breaking 変更。
- [x] `event_threads` 永続化モデルを導入（migration 追加、post 作成/イベント受信時に thread 情報を upsert 保存）。
- [x] `get_thread_posts(topic_id, thread_uuid)` の取得経路を実装（DTO/handler/command/repository を追加）。
- [x] 互換 backfill は実装せず、Phase1 要件どおり新規データ経路のみ整備。
- [x] 進捗レポート `docs/01_project/progressReports/2026-02-23_issue140_thread_foundation_phase1.md` を追加。

## 検証（Issue #140）

- [x] `cd kukuri-tauri/src-tauri && cargo fmt`（pass）
- [x] `cd kukuri-tauri/src-tauri && cargo test`（pass）
- [x] `bash ./scripts/test-docker.sh ts`（pass）
- [x] `bash ./scripts/test-docker.sh lint --no-build`（pass）
- [x] `docker compose -f docker-compose.test.yml up -d community-node-postgres`（pass）
- [x] `docker compose -f docker-compose.test.yml build test-runner`（pass）
- [x] `docker run --rm --network kukuri_community-node-network -e DATABASE_URL=postgres://cn:cn_password@community-node-postgres:5432/cn -v "$(git rev-parse --show-toplevel):/workspace" -w /workspace/kukuri-community-node kukuri-test-runner bash -lc "set -euo pipefail; source /usr/local/cargo/env; cargo test --workspace --all-features; cargo build --release -p cn-cli"`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job format-check`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job native-test-linux`（pass）
- [x] `NPM_CONFIG_PREFIX=/tmp/npm-global gh act --workflows .github/workflows/test.yml --job community-node-tests`（pass）
