## リファクタリングプラン: アクティブ導線トレース
- [x] `node scripts/check-tauri-commands.mjs` で Tauri コマンド 85 件の呼び出し状況を再確認し、未参照コマンドなしを証跡化（`docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md` 2025年11月17日節へ追記）。
- [x] `docs/01_project/activeContext/artefacts/phase5_feature_usage_map.md` 第3.1節に UIイベント→Hook/Store→Tauriコマンド→テスト ID / Nightly artefact の表を追加し、`phase5_user_flow_inventory.md` 導線 ID と突き合わせた。
- [x] `docs/01_project/deprecated/refactoring_plan_2025-08-08_v3.md` 2.5.2 の 3 つ目のチェック項目へ 2025年11月17日の追記を追加し、リファクタリングプラン上でもクローズ済みとした。

### 蠖ｱ髻ｿ繝輔ぃ繧､繝ｫ
- `scripts/check-tauri-commands.mjs`
- `docs/01_project/activeContext/artefacts/phase5_feature_usage_map.md`
- `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md`
- `docs/01_project/deprecated/refactoring_plan_2025-08-08_v3.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

## 鍵管理ダイアログと鍵バックアップ/復旧フロー
- [x] Settings > アカウントに新しい `KeyManagementDialog` を実装し、エクスポート/インポート・注意喚起・履歴表示・クリップボード/ファイル保存機能を提供。`useKeyManagementStore` を `withPersist` で永続化し、操作ログを最大20件まで保持できるようにした。
- [x] `export_private_key` Tauri コマンド／`TauriApi.exportPrivateKey` を追加し、`AuthService` を利用したバックアップ API を公開。`tests/key_management.rs` でインメモリ Secure Storage を使ったラウンドトリップを検証し、Runbook Chapter4 に鍵バックアップ/復旧チェックリストを追加。
- [x] `src/tests/unit/components/settings/KeyManagementDialog.test.tsx`・`src/tests/unit/stores/keyManagementStore.test.ts` を追加し、`./scripts/test-docker.ps1 ts` で Vitest を実行。Rust 側は `./scripts/test-docker.ps1 rust -Test key_management` で契約テストを Docker 上で実行してログを確認。`phase5_user_flow_inventory.md` / `phase5_user_flow_summary.md` / `tasks/status/in_progress.md` を更新して MVP ギャップをクローズ。

### 影響ファイル
- `kukuri-tauri/src/components/settings/KeyManagementDialog.tsx`
- `kukuri-tauri/src/routes/settings.tsx`
- `kukuri-tauri/src/stores/keyManagementStore.ts`
- `kukuri-tauri/src/stores/config/persist.ts`
- `kukuri-tauri/src/lib/api/tauri.ts`
- `kukuri-tauri/src-tauri/src/presentation/commands/auth_commands.rs`
- `kukuri-tauri/src-tauri/src/lib.rs`
- `kukuri-tauri/src-tauri/tests/key_management.rs`
- `kukuri-tauri/src/tests/unit/components/settings/KeyManagementDialog.test.tsx`
- `kukuri-tauri/src/tests/unit/stores/keyManagementStore.test.ts`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md`
- `docs/01_project/activeContext/artefacts/phase5_user_flow_summary.md`
- `docs/03_implementation/p2p_mainline_runbook.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 実行コマンド
- `./scripts/test-docker.ps1 ts`
- `./scripts/test-docker.ps1 rust -Test key_management`

## Nightly trending-feed artefact 再編
- [x] `.github/workflows/nightly.yml` に `tmp/logs/trending-feed` / `test-results/trending-feed` の事前クリーンアップを追加し、`nightly.trending-feed-logs` / `nightly.trending-feed-reports` / `nightly.trending-feed-metrics` の artefact を公開。`ACT=true` で動く `gh act` では artefact ステップを自動スキップし、代わりに `List trending feed outputs (act)` で生成物を列挙できるようにした。
- [x] `docs/01_project/activeContext/artefacts/phase5_ci_path_audit.md` と `docs/01_project/activeContext/tasks/status/in_progress.md` を更新し、ナイトリー ID の命名・Runbook 参照先・`gh act --bind --container-options "--privileged"` 前提を反映。
- [x] `docs/01_project/progressReports/nightly.trending-feed.md` を新規作成し、GitHub Actions / gh act / Docker スクリプトでの再現手順と artefact 参照先、`tmp/gh-act-trending-feed*.log` の収集方法を整理。

### 実行コマンド
- `./scripts/test-docker.ps1 ts -Scenario trending-feed -NoBuild`
- `gh act --bind --workflows .github/workflows/nightly.yml --job trending-feed --container-options "--privileged" -P ubuntu-latest=ghcr.io/catthehacker/ubuntu:act-latest *> tmp/gh-act-trending-feed-after.log`

## Ops/CI: Corepack + pnpm 初期化 Runbook 化
- [x] `docs/01_project/setup_guide.md` に Windows/macOS/Linux 向けの `cmd.exe /c "corepack enable pnpm"` → `corepack pnpm install --frozen-lockfile` フローを追記し、Nightly 再現前提を明文化。
- [x] `docs/01_project/progressReports/nightly.trending-feed.md` のローカル再現節へ Corepack/pnpm 初期化セクションを追加し、`scripts/test-docker.ps1 ts -Scenario trending-feed` 実行前に残すべきログと手順を整理。
- [x] `scripts/test-docker.ps1` の `all` / `ts` / `lint` などで Corepack/Pnpm 初期化チェックを追加し、`cmd.exe /c "corepack pnpm --version"` と `node_modules/.modules.yaml` の両方が揃っていない場合は即時に失敗理由を表示するようにした。`docs/01_project/activeContext/tasks/status/in_progress.md` で 14-2 をクローズ。

### 影響ファイル
- `docs/01_project/setup_guide.md`
- `docs/01_project/progressReports/nightly.trending-feed.md`
- `scripts/test-docker.ps1`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 実行コマンド
- なし（ドキュメント/スクリプト更新のみ）

## Nightly artefact マッピング整理
- [x] `docs/01_project/progressReports/nightly.index.md` を作成し、`nightly.trending-feed` / `nightly.profile-avatar-sync` / `nightly.topic-create` など 8 つの Nightly ID について GitHub Actions ジョブ・再現コマンド・`*-logs` / `*-reports` artefact の内容を表形式と個別メモで整理。Runbook の参照先とログ/JSON の保管場所も明記した。
- [x] `docs/01_project/progressReports/README.md` に Nightly Runbook セクションを追加し、`nightly.index.md` と `nightly.trending-feed.md` を入口として掲示。
- [x] `docs/01_project/activeContext/tasks/status/in_progress.md` の 14-3 をクローズし、完了内容として Nightly artefact マッピングの更新先を追記。

### 影響ファイル
- `docs/01_project/progressReports/nightly.index.md`
- `docs/01_project/progressReports/README.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 実行コマンド
- なし（ドキュメント更新のみ）

## gh act CI failure Runbook
- [x] `docs/01_project/progressReports/gh-act_ci-runbook.md` を作成し、`gh act` での再現前提（`--bind` / `--container-options "--user 0"` / `--artifact-server-path tmp/act-artifacts`）と Format Check / Nightly `profile-avatar-sync` の具体的なコマンド・ログ採取手順を整理。
- [x] `docs/01_project/progressReports/README.md` / `nightly.index.md` に新 Runbook への導線を追加し、Nightly ID から `gh act` 手順へ遷移できるようにした。
- [x] `docs/01_project/activeContext/tasks/status/in_progress.md` で 14-4 をクローズし、`tmp/gh-act-format-check.log` / `tmp/gh-act-profile-avatar-sync.log` でグリーンを確認した旨を記録。

### 影響ファイル
- `docs/01_project/progressReports/gh-act_ci-runbook.md`
- `docs/01_project/progressReports/README.md`
- `docs/01_project/progressReports/nightly.index.md`
- `docs/01_project/activeContext/tasks/status/in_progress.md`

### 実行コマンド
- `gh act --bind --workflows .github/workflows/test.yml --job format-check --container-options "--user 0" -P ubuntu-latest=ghcr.io/catthehacker/ubuntu:full-latest > tmp/gh-act-format-check.log 2>&1`
- `mkdir -p tmp/act-artifacts && gh act --bind --workflows .github/workflows/nightly.yml --job profile-avatar-sync --container-options "--privileged --user 0" -P ubuntu-latest=ghcr.io/catthehacker/ubuntu:full-latest --artifact-server-path tmp/act-artifacts > tmp/gh-act-profile-avatar-sync.log 2>&1`

## Ops/CI: Nightly & GitHub Actions で MVP 導線を安定再現（タスク14）
- [x] `.github/workflows/nightly.yml` の `trending-feed` ジョブで `nightly.trending-feed-*` artefact 命名と `ACT` ガードが揃っていることを確認し、`profile-avatar-sync` など他シナリオも `docs/01_project/progressReports/nightly.trending-feed.md` / `nightly.index.md` から Runbook / artefact 一覧へ辿れる状態であることを検証。
- [x] `docs/01_project/setup_guide.md`・`scripts/test-docker.ps1` の Corepack + pnpm 初期化ガードと `scripts/test-docker.ps1 all` 前提条件が一致していることを再確認し、Docker 経由テスト前に同じシェル初期化手順をたどれるようになっている点をチェック。
- [x] `docs/01_project/progressReports/README.md` → `nightly.index.md` → `gh-act_ci-runbook.md` の導線および Nightly ID ごとのログ/JSON マッピングを確認し、GitHub Actions / Nightly failure 時に参照先へ迷わず遷移できる状態が整っていることを証跡化。
- [x] `docs/01_project/activeContext/tasks/status/in_progress.md` からタスク14を削除し、完了記録を本ファイルへ追記。

### 影響ファイル
- `docs/01_project/activeContext/tasks/status/in_progress.md`
- `docs/01_project/activeContext/tasks/completed/2025-11-17.md`

### 実行コマンド
- なし（確認のみ）
