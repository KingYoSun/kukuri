# 2025年11月01日 完了タスク（in_progress 整理）

最終更新日: 2025年11月01日

このエントリは 2025年11月01日時点で `tasks/status/in_progress.md` に残っていた完了済み項目を移設したものです。履歴確認のため、元のチェックリスト構成を保持しています。

## Clippy 完全解消

- [x] `cargo clippy --workspace --all-features -- -D warnings` をゼロエラーで完走させる（2025年10月31日: `kukuri-tauri/src-tauri` と `kukuri-cli` の両方で実行し警告ゼロを確認）
  - [x] `domain/entities/event.rs` の `format!` 最適化と `as_bytes` 警告を解消
  - [x] `DefaultEncryptionService` / `EventHandler` / `LegacyEventManagerHandle` / `NostrClientManager` に `Default` 実装を追加
  - [x] Clippy 結果と手順を `phase5_ci_path_audit.md` と `refactoring_plan_2025-08-08_v3.md` に反映（2025年10月31日更新）

## 残存 TODO 実装

- [x] `infrastructure/p2p/event_distributor.rs` のブロードキャスト/配信経路 TODO を実装（2025年10月31日: Gossip/DHT配信処理と依存注入を追加し、Docker経由で Rust テストを完走）
- [x] `infrastructure/p2p/dht_integration.rs` の実装 TODO を完了（2025年10月31日: Nostr⇔ドメイン変換実装と単体テスト追加）
- [x] `domain/p2p/topic_mesh.rs` の購読処理 TODO を実装
  - 2025年10月31日: Codex作業開始。TopicMesh購読APIとIroh連携の実装方針を調査中。
  - 2025年11月01日: 購読初期リプレイと自動解除を実装し、Receiver切断時に購読が解除されるガードとユニットテストを追加。
- [x] `application/services/post_service.rs` のトピック別投稿キャッシュ TODO に対応
  - 2025年11月01日: キャッシュとDB結果を統合し、キャッシュ専用投稿が維持されるユニットテストを追加。
- [x] `src/components/layout/Sidebar.tsx` の未読カウント TODO を実装しテストを追加
  - 2025年11月01日: 未読バッジ表示のテストIDを追加し、未投稿表示と未読0件時の挙動テストを整備。
- [x] 残存 TODO の棚卸し結果を `phase5_dependency_inventory_template.md` に追記
  - 2025年11月01日: TopicMesh/PostService/Sidebarの依存棚卸しメモを更新。

## 巨大ファイル分割（Phase 5 継続）

- [x] `infrastructure/p2p/event_distributor` を責務別モジュールに再構成し、`mod.rs` で API を再輸出
  - 2025年11月01日: `default.rs` / `strategy.rs` / `metrics.rs` / `state.rs` へ分割し、`tests.rs` を新設。P2P/Nostr ラッパーにサービス設定メソッドを追加。
- [x] `application/services/p2p_service` を `core` / `bootstrap` / `metrics` / `status` 構成へ再編
  - 2025年11月01日: `builder.rs` を `bootstrap.rs` へリネームし、メトリクスサマリ変換を新設 `metrics.rs` へ移動。`core.rs` を新しいモジュールに合わせて更新。
- [x] `cargo test`（Docker 経由で kukuri-tauri、ローカルで kukuri-cli）および `pnpm test` を実行しリグレッションなしを確認
  - 2025年11月01日: `./scripts/test-docker.ps1 rust` で Rust テストを完走（ログで成功確認）、`kukuri-cli` はローカル `cargo test`、フロントは `pnpm test` を実施。
- [x] `phase5_dependency_inventory_template.md` / `refactoring_plan_2025-08-08_v3.md` を更新し、700行超ファイルゼロ指標を反映
  - 2025年11月01日: 依存棚卸しに新モジュール構成を追記し、リファクタリング計画の成功指標を達成済みに更新。
