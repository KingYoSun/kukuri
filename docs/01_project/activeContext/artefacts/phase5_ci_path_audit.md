# Phase 5 CI/ローカルスクリプト パス依存調査
最終更新日: 2025年11月10日

| 対象 | 現状参照パス／コマンド | 影響範囲 | 修正案 |
| --- | --- | --- | --- |
| `scripts/docker/run-smoke-tests.sh` | `cargo test --package kukuri-tauri --test p2p_gossip_smoke -- --nocapture --test-threads=1`<br>`cargo test --package kukuri-tauri --test p2p_mainline_smoke -- --nocapture --test-threads=1` | Docker スモークテストで新テストバイナリを並列実行。 | 2025年10月22日: フォールバックロジックを撤廃し、新バイナリを常に実行する構成へ更新済み。 |
| `scripts/test-docker.sh` | `./scripts/test-docker.sh p2p` / `./scripts/test-docker.sh performance` | ローカル Docker P2P テストに加え、性能ハーネス（ignored テスト）を `performance` サブコマンドで実行。 | 2025年10月22日: フォールバック削除・エイリアス追加を完了し、旧スモークバイナリへの依存を解消。<br>2025年10月31日: `performance` サブコマンドを追加し、計測結果を `test-results/performance/*.json` に保存。 |
| `scripts/test-docker.ps1` | `cargo test --package kukuri-tauri --test p2p_gossip_smoke`<br>`cargo test --package kukuri-tauri --test p2p_mainline_smoke`<br>`cargo test --package kukuri-tauri --test <target>`<br>`./scripts/test-docker.ps1 performance` | Windows 用 Docker テストでスモーク + 個別ターゲット + 性能ハーネスを切替。`performance` 実行時は `cargo test --test performance -- --ignored --nocapture` を呼び、成果物を `test-results/performance` に出力。 | 2025年10月22日: 新バイナリ固定化とログ整備を完了。<br>2025年10月30日: `-Test` オプションを追加し、`event_manager_integration` など個別テストを `./scripts/test-docker.ps1 rust -Test <target>` で実行可能にした。<br>2025年10月31日: `performance` コマンドを追加し、成果物出力先を PowerShell からも制御可能にした。 |
| `scripts/test-docker.{sh,ps1}` coverage コマンド | `./scripts/test-docker.sh coverage` → `docker compose run rust-coverage`（`cargo tarpaulin --locked --all-features --out Json --out Lcov --output-dir /app/test-results/tarpaulin`） | Rust カバレッジ測定を Docker 上で再現し、成果物を `docs/01_project/activeContext/artefacts/metrics/*.json/.lcov` に出力。 | 2025年10月26日: `rust-coverage` サービスを Compose に追加し、tarpaulin の JSON/LCOV を `test-results/tarpaulin` 経由で保存。Shell/PowerShell の両方から同一フローで呼び出せるようにした。 |
| `scripts/metrics/export-p2p.{sh,ps1}` | `cargo run --manifest-path kukuri-tauri/src-tauri/Cargo.toml --bin p2p_metrics_export -- --output <path>` | Gossip/Mainline メトリクスを JSON として保存し、CI から artefacts/metrics に収集する。 | 2025年10月27日: Phase 5 Workstream A/B のメトリクス要件に合わせて追加。`--pretty` を指定すると human readable。 |
| `docker-compose.test.yml` (`test-runner` / `rust-test`) | ボリューム: `./kukuri-tauri/src-tauri/src` / `./kukuri-tauri/src-tauri/tests` を read-only でマウント | Phase 5 で Rust テスト資産を `src-tauri/tests` へ集約しても、ローカル編集が即座に反映される。 | 2025年10月31日: `test-runner` と `rust-test` に加え `rust-coverage` へも `./kukuri-tauri/src-tauri/tests` のマウントを追加し、`docker_test_environment.md` / `windows_test_docker_runbook.md` に反映済み。 |
| GitHub Actions `test.yml`（Docker ジョブ） | `/app/run-tests.sh` → `cargo test --workspace`（`tests/` 配下の新バイナリを網羅実行） | `run-tests.sh` が Phase 5 更新後の `cargo test` を利用できるようにする必要がある。 | `run-tests.sh` 内で個別モジュールパスを指定しないため直接の修正は不要だが、P2P スモークを追加する際は `--test p2p_gossip_smoke` / `--test p2p_mainline_smoke` を明示する。 |
| `package.json` `test:unit` スクリプト | `pnpm test:unit` → `vitest run src/tests/unit` | フロントエンドのユニットテスト群を Phase 5 新規テスト（プロフィールアバター導線など）込みで一括実行。CI/ローカル双方で同一コマンドを呼び出せるように共通化。 | 2025年11月03日: `package.json` に `test:unit` を追加し、Nightly Frontend Unit Tests ワークフロー（cron: `0 15 * * *`）から `pnpm test:unit` を実行する構成を追加。`tauri_app_implementation_plan.md` と整合。<br>2025年11月06日: DM 未読バッジ・トレンド/フォロー導線・ユーザー検索のユニットテストを Inventory 5.7-5.10 / Summary 3 の結果と合わせて Nightly ワークフローへ反映し、`DirectMessageDialog` / `TrendingSummaryPanel` / `FollowingSummaryPanel` / `UserSearchResults` のケースを追加。<br>2025年11月08日: `Header.test.tsx`（Inbox/未読バッジ）・`useDirectMessageBadge.test.tsx`・`components/trending/TrendingSummaryPanel.test.tsx`・`components/following/FollowingSummaryPanel.test.tsx` に加え、`directMessages/DirectMessageInbox.test.tsx` を追加し、Nightly Frontend Unit Tests で DM 導線 CTA / 候補検索 / 既読フローの回帰を監視。<br>2025年11月09日: `components/SyncStatusIndicator.test.tsx`・`components/OfflineIndicator.test.tsx`・`components/RelayStatus.test.tsx` を Nightly 監視対象に追加し、`sync_queue` メタデータの表示（要求者/要求時刻/キュー ID）と Offline バナー/Runbook CTA を検証。Rust 側は `cargo test offline_handler::tests::add_to_sync_queue_records_metadata_entry` を `scripts/test-docker.ps1/sh rust` ルートに含め、手動再送キュー登録時の `cache_metadata` 永続化を CI で保証。<br>2025年11月10日: Inventory 5.9/5.10 対応で `TopicSelector.test.tsx` / `PostComposer.test.tsx` / `Sidebar.test.tsx` / `PostCard.test.tsx` を Nightly 対象へ追加。ローカルでは `pnpm` コマンドが存在せず `corepack pnpm` もシバン差異で失敗するため、CI 先行で検証し、実行環境の整備が必要である旨を in_progress.md に記録。 |
| `corepack pnpm` 構築 | `corepack enable pnpm && corepack pnpm --version` | `pnpm` バイナリが無い環境（Windowsホスト）でも `pnpm vitest` / `pnpm test:unit` を再現するための前提コマンド。 | 2025年11月10日: `cmd.exe /c "corepack enable pnpm"` で Windows 側の shim を初期化し、`cmd.exe /c "corepack pnpm --version"` で 10.16.1 を確認。`phase5_user_flow_summary.md` Ops/CI 行と Runbook に再現手順・ログ (`tmp/logs/corepack_setup_20251110013111.log`) を追記予定。 |
| プロフィール設定 + Avatar Stage3 テスト | `pnpm vitest run src/tests/unit/components/settings/ProfileEditDialog.test.tsx src/tests/unit/components/auth/ProfileForm.test.tsx src/tests/unit/components/auth/ProfileSetup.test.tsx` | Stage3（Doc/Blob + privacy 同期）の UI/状態遷移を検証。保存時の直列実行・ロールバック・プレビュー更新が想定どおりかを `ProfileForm` / `ProfileEditDialog` / `ProfileSetup` でカバーし、`phase5_user_flow_inventory.md` 5.1・Sec.6 と `tauri_app_implementation_plan.md` Phase4.4 を裏付ける。 | 2025年11月09日: corepack 有効化後にローカル実行可能になったため、Stage3 実装後は本コマンドを Nightly Frontend Unit Tests と `scripts/test-docker.ps1 ts -Tests ProfileEditDialog` に追加して回帰保証する。 |
| `profile_avatar_sync` Rust 結合テスト | `cargo test --package kukuri-tauri --test profile_avatar_sync`（Linux/macOS）<br>`./scripts/test-docker.ps1 rust -Test profile_avatar_sync`（Windows 迂回） | `ProfileAvatarService` の Upload→Export→Import→Fetch パスと Blob/Doc ticket の整合性を確認し、Stage3 で privacy flag と `ProfileAvatarAccessLevel` が一致することを担保。 | 2025年11月10日: `phase5_user_flow_inventory.md` 5.1 / Sec.6 に Stage3 要件とログ採取手順を反映。Windows 既知の `STATUS_ENTRYPOINT_NOT_FOUND` は Docker Rust テストで代替し、`./scripts/test-docker.ps1 rust -Test profile_avatar_sync -NoBuild` の実行ログを `tmp/logs/profile_avatar_sync_<timestamp>.log` に保存。Nightly では `scripts/test-docker.sh ts --scenario profile-avatar-sync` / `.ps1 ts -Scenario profile-avatar-sync` を追加し、TS/Rust 両方のログを Runbook Chapter4 へ紐付ける。 |
| `pnpm vitest run src/tests/unit/components/topics/TopicSelector.test.tsx …` | `pnpm vitest run src/tests/unit/components/topics/TopicSelector.test.tsx src/tests/unit/components/posts/PostCard.test.tsx src/tests/unit/stores/postStore.test.ts` | グローバルコンポーザーのトピック作成ショートカット（Inventory 5.9）と投稿削除後のキャッシュ整合性（5.10）を検証。 | 2025年11月10日: `cmd.exe /c "corepack enable pnpm"` → `pnpm install --frozen-lockfile`（`kukuri-tauri`）を踏んだ上でローカル再実行し、`tmp/logs/vitest_topic_create_20251110020423.log` を採取。TopicSelector/PostComposer/Sidebar/GlobalComposer/PostStore の回帰を Nightly に頼らず確認できる状態へ復旧。 |
| Nightly / `gh act` ログの保存場所 | `tmp/logs/*.log` (`gh_act_native_20251109_postlint.log`, `docker_rust_test_20251109.log` など) | ローカルで実行した `gh act push` / `docker compose` / `scripts/test-docker.ps1` の結果を共有し、CI ブロッカーを可視化。 | 2025年11月09日: `tmp/logs/gh_act_native_20251109_postlint.log`, `tmp/logs/gh_act_format_20251109.log`, `tmp/logs/docker_rust_test_20251109.log` を作成。`tasks/status/in_progress.md` GitHub Actions セクションと `phase5_user_flow_summary.md` Ops/CI 行で参照。 |
| Docker シナリオ `trending-feed` | `./scripts/test-docker.sh ts --scenario trending-feed`<br>`.\scripts\test-docker.ps1 ts -Scenario trending-feed` | `/trending` `/following` ルート専用の Vitest セットを Docker 内で再現し、トレンドメトリクス/API 変更時のリグレッションを検出。Nightly Frontend Unit Tests の後段で実行し、`test-results/trending-feed/*.json` を生成して確認ログを保存する。 | 2025年11月07日: シナリオ要件を整理（Docker で `pnpm vitest run src/tests/unit/routes/trending.test.tsx src/tests/unit/routes/following.test.tsx src/tests/unit/hooks/useTrendingFeeds.test.tsx` を実行。`VITE_TRENDING_FIXTURE_PATH` でフィクスチャを選択可能にし、既定は `tests/fixtures/trending/default.json`）。`scripts/test-docker.{sh,ps1}` に `--scenario/-Scenario` オプションを追加し、`ts` コマンドからシナリオを切替。Nightly ワークフローに `Trending Feed (Docker)` ジョブを追加し、失敗時は `phase5_ci_path_audit.md` へリンクしたアラートを残す。2025年11月10日: ローカルで `./scripts/test-docker.sh ts --scenario trending-feed --no-build` を実行し、`tmp/logs/trending-feed_20251110020528.log` を保存。|
| `cargo clippy`（Rust Lint） | `kukuri-tauri/src-tauri`: `cargo clippy --workspace --all-features -- -D warnings`<br>`kukuri-cli`: `cargo clippy --workspace --all-features -- -D warnings` | Phase 5 のゲート条件として、Tauri アプリと CLI の双方で Clippy 警告ゼロを維持する。CI では共通ルートに `Cargo.toml` が無いため、各ディレクトリで明示的に呼び出す必要がある。 | 2025年10月31日: 両ディレクトリでコマンドを実行し、警告ゼロで完走することを確認。`lint` 系ジョブでは 2 回の `cargo clippy` を順番に呼ぶ手順を記載した。<br>2025年11月01日: 指示どおり `cargo clippy --all-features -- -D warnings` を kukuri-tauri/src-tauri と kukuri-cli の両方で再実行し、警告ゼロ継続を確認。CI lint ジョブにも kukuri-cli 向け Clippy 実行を追加済み。 |
| トレンド/フォロー中フィード UI テスト | `pnpm vitest run src/tests/unit/routes/trending.test.tsx src/tests/unit/routes/following.test.tsx`<br>`pnpm vitest run src/tests/unit/hooks/useTrendingFeeds.test.tsx` | `/trending`・`/following` ルートのランキング表示、Summary Panel メトリクス、無限スクロール、エラー再試行、DM 未読バッジ連携を検証。 | 2025年11月05日: フック層ユニットテストと `docker compose -f docker-compose.test.yml up --build --abort-on-container-exit --exit-code-from test-runner test-runner` を完走。2025年11月07日: ルートコンポーネントのユニットテストを Nightly Frontend Unit Tests に追加し、手動 QA で `formatDistanceToNow`（ミリ秒入力）・空ページ境界・再試行導線を確認。2025年11月08日: `trending_metrics_job` 常駐化後も `generated_at` と Summary Panel の件数が一致することを Docker/Nightly と Vitest で確認。 |
| Prometheus エクスポート（`trending_metrics_job`） | `curl http://localhost:${KUKURI_METRICS_PROMETHEUS_PORT}/metrics > tmp/logs/trending_metrics_job_<timestamp>.prom` | `runs_total` / `failures_total` / `topics_upserted` / `expired_records` / `duration_seconds_bucket` を定期採取し、ジョブの遅延や連続失敗を検出。Nightly 無人監視が整うまでは手動で `tmp/logs/` に保存したテキストを Runbook とリンクする。 | 2025年11月10日: `MetricsConfig` に `prometheus_port` / `emit_histogram` を追加し、`TrendingMetricsJob` が `tiny_http` サーバー経由で Prometheus 形式のメトリクスを公開。`KUKURI_METRICS_PROMETHEUS_PORT=9898` で `curl http://localhost:9898/metrics | tee tmp/logs/trending_metrics_job_20251110.prom` を取得し、監視手順を `docs/03_implementation/trending_metrics_job.md` と本表へ追記。 |
| ユーザー検索導線テスト | `pnpm vitest run src/tests/unit/components/search/UserSearchResults.test.tsx src/tests/unit/hooks/useUserSearchQuery.test.ts`（新設予定） | `/search` (users) のデバウンス・ページネーション・レート制限ハンドリング。Nightly Frontend Unit Tests に 2025年11月導入予定。 | 2025年11月04日: Inventory 5.8 にテスト観点を追加。Vitest ファイルを作成後、Nightly ワークフローへ追記し、レートリミットケースは `vi.useFakeTimers` で安定化させる。Docker シナリオ `user-search-pagination` を PowerShell スクリプトに追加予定。 |
| グローバルコンポーザー トピック作成テスト | `pnpm vitest run src/tests/unit/components/posts/GlobalComposer.test.tsx src/tests/unit/components/layout/Sidebar.test.tsx` | グローバルコンポーザーとサイドバーのトピック作成ショートカット（`GlobalComposer.topic-create` / `TopicSelector.create-shortcut`）を検証。Nightly Frontend Unit Tests に組み込む。 | 2025年11月06日: Inventory 5.9 に沿ってテストケースを追加し、PowerShell 版 `test-docker.ps1 ts` にも同ケースを連携。 |
| 投稿削除キャッシュ整合性テスト | `pnpm vitest run src/tests/unit/hooks/useDeletePost.test.ts src/tests/unit/components/posts/PostCard.test.tsx`<br>`./scripts/test-docker.sh ts --scenario post-delete-cache --no-build` | React Query キャッシュ無効化と Docker シナリオ `post-delete-cache` を通じて `useDeletePost` / `post_delete_flow` の整合性を監視。 | 2025年11月10日: `ts-test` 用エントリポイント（`scripts/docker/ts-test-entrypoint.sh`）を追加し、Docker から `pnpm vitest run …` を直接叩けるようにした。`./scripts/test-docker.sh ts --scenario post-delete-cache --no-build` を完走し、`tmp/logs/post-delete-cache_docker_20251110-021922.log` を保存。 |
| `offlineStore` メタデータ同期テスト | `pnpm vitest run src/tests/unit/stores/offlineStore.test.ts` | SyncStatusIndicator で参照するメタデータ更新・同期ステータス更新フローを検証。 | 2025年11月06日: `update_cache_metadata` / `update_sync_status` の配線に合わせてテストを拡張し、未同期件数・エラー数のスナップショットを監視するケースを追加。 |
| SyncStatusIndicator / useSyncManager テスト | `npx vitest run src/tests/unit/hooks/useSyncManager.test.tsx src/tests/unit/components/SyncStatusIndicator.test.tsx src/tests/unit/components/OfflineIndicator.test.tsx` | `SyncStatusIndicator` / `OfflineIndicator` のステータス表示、`get_cache_status` / `add_to_sync_queue` / `list_sync_queue_items` / `update_cache_metadata` / `update_sync_status` の呼び出し整合性、手動再送ボタン・再送履歴（Queue ID フィルタ/ハイライト/エラー表示）とキャッシュ統計表示を検証。 | 2025年11月07日: `useSyncManager` に `cacheStatus` ステートと `enqueueSyncRequest` を追加し、Vitest でキャッシュ統計・エラー再送 UI をカバー。2025年11月09日: `list_sync_queue_items` / 再送キュー履歴 UI を実装し、`npx vitest run …` で Queue ID 記録・フィルタリング・エラーハンドリングの回帰を追加。Inventory 5.11 / Summary Quick View / Refactoring Plan のユーザー導線指標とリンク。 |

## 関連ドキュメント
- `phase5_user_flow_inventory.md` — UI 導線と Tauri コマンドの棚卸し結果（2025年11月07日更新: 5.6.1/5.6.2 の `/profile/$userId` 導線刷新、5.11「SyncStatusIndicator とオフライン同期導線」の追加、`get_cache_status` / `add_to_sync_queue` 連携とテスト計画を反映）
- `phase5_user_flow_summary.md` — 2025年11月07日更新。Quick View に同期導線・プロフィール導線の優先度とステータス、Summary Panel/Docker シナリオの注記を追加。
- 新導線テスト: `src/tests/unit/stores/composerStore.test.ts` / `src/tests/unit/stores/privacySettingsStore.test.ts` / `src/tests/unit/pages/Home.test.tsx` — グローバルコンポーザーとプライバシー設定のユニットテストを2025年11月02日に追加。Relay/P2P ステータスカードのテスト計画は下記参照。

## テスト更新ログ（2025年11月03日）
- `npx vitest run src/tests/unit/components/RelayStatus.test.tsx src/tests/unit/components/P2PStatus.test.tsx src/tests/unit/stores/authStore.test.ts src/tests/unit/stores/p2pStore.test.ts src/tests/unit/hooks/useP2P.test.tsx src/tests/unit/lib/api/p2p.test.ts` を実行し、バックオフ実装・手動リトライ・新フィールド反映を検証済み。
- Rust 側では `cargo test`（`kukuri-tauri/src-tauri` / `kukuri-cli`）を実行し、`application::services::p2p_service::tests` の `connection_status` / `peers` 追加に伴うフォールバック挙動を確認。
- `src/tests/integration/profileAvatarSync.test.ts`（2025年11月02日実装）: `upload_profile_avatar` / `fetch_profile_avatar` をモックし、Doc レプリケーションと Blob 復号フローを検証。Vitest 統合テストに組み込み済みで、Rust 側の `tests/profile_avatar_sync.rs` ではマルチノード同期と `StreamEncryptor` 復号パスをカバー。

## 追加予定のテスト
- `ProfilePage` 向けにフォロー/フォロー解除ハンドリングのユニットテストを追加し、`follow_user` / `unfollow_user` 成功・失敗・未ログイン時の各パスで React Query キャッシュとボタン状態、トースト通知が期待どおりに遷移することを検証する（楽観更新→ロールバックを含む）。
- `DirectMessageDialog`（新規）で kind 4 DM の送受信フローをモックし、未読バッジ更新・オフライン再送キュー登録・`send_direct_message` 失敗時のリトライ UI をテストする。Rust 側では `send_direct_message` コマンドの暗号化/署名/配信エラーをユニットテストでカバーする。
- フォロワー/フォロー中リストの無限スクロールとソート切り替えを `useInfiniteQuery` のテストで再現し、カーソル・ソート条件が API パラメーターへ正しく引き継がれること、`total_count` を利用した進捗表示が更新されることを確認する。Rust 側はカーソル境界（先頭/末尾）とプライベートアカウント時の 403 応答を含む結合テストを追加する。
- 2025年11月07日: `TrendingRoute` / `FollowingRoute` のユニットテスト（ランキング表示・エラー再試行・未読境界）を Nightly Frontend Unit Tests へ追加。2025年11月08日: `list_trending_topics` / `list_trending_posts` が `topic_metrics` の最新ウィンドウを反映することを Docker `trending-feed` で検証し、Nightly に合流。
- Docker シナリオ `trending-feed` を `scripts/test-docker.{sh,ps1}` に実装し、`docker-compose.test.yml` の `test-runner` エントリポイントを `pnpm vitest run ...` のシナリオ引数対応へ拡張済み。Nightly 用の `nightly.yml` へ「Trending Feed (Docker)」ジョブを追加し、`needs: unit-tests` で連結。失敗時には `test-results/trending-feed/latest.log` を artefact として保存し、Runbook のトリアージ手順へリンクする。
- `UserSearchResults` / `useUserSearchQuery` の新テストで 2 文字未満クエリ・レート制限・カーソルページネーションを検証し、Docker シナリオ `user-search-pagination` と連携させる。

## 関連資料（ユーザー導線）
-  - `docs/01_project/activeContext/artefacts/phase5_user_flow_inventory.md` — 2025年11月07日更新。導線別の API/テスト計画と CI 連携ポイントを整理。
  - `docs/01_project/activeContext/artefacts/phase5_user_flow_summary.md` — 2025年11月07日更新。導線ステータスと Quick View の優先度を把握するサマリー。
  - `docs/03_implementation/docker_test_environment.md` — 2025年11月07日更新。Docker テスト共通フローと OS 別 Runbook（`windows_test_docker_runbook.md`）の参照元。
- `docs/03_implementation/trending_metrics_job.md` — 2025年11月08日更新。トレンドメトリクス集計ジョブの実装方針・監視指針・CI 連携・AppConfig 連動を確定版として記録。
- `docs/01_project/refactoring_plan_2025-08-08_v3.md` — ユーザー導線指標と Phase 5 backlog の整合を確認する指標一覧。
| corepack pnpm セットアップ | corepack enable pnpm && pnpm install --frozen-lockfile | Windows ホストに pnpm バイナリが存在しない問題を解消し、Vitest / Nightly と同一コマンドをローカルでも実行できるようにする前提手順。 | 2025年11月10日: shebang 問題を `cmd.exe /c "corepack enable pnpm"` で回避し、続けて `cmd.exe /c "cd /d C:\Users\kgm11\kukuri\kukuri-tauri && pnpm install --frozen-lockfile"` を完走。以降の Vitest 実行ログ（例: `tmp/logs/vitest_topic_create_20251110020423.log`）でホスト環境の再現性を確認。 |
| scripts/test-docker.{sh,ps1} ts -Scenario profile-avatar-sync | ./scripts/test-docker.sh ts -Scenario profile-avatar-sync ; ./scripts/test-docker.ps1 ts -Scenario profile-avatar-sync -NoBuild | プロフィール Stage3（Doc/Blob + privacy）シナリオを Docker で再現し、TS/Rust 双方のログを tmp/logs/profile_avatar_sync_<timestamp>.log に集約。Nightly profile-avatar-sync ジョブと Runbook Chapter4 から参照する。 | 2025年11月10日: シナリオを scripts に追加。phase5_user_flow_inventory.md 5.1 / phase5_dependency_inventory_template.md / tauri_app_implementation_plan.md で参照しており、CI でも同ログを必ず保存する。 |
| scripts/test-docker.{sh,ps1} ts -Scenario trending-feed | ./scripts/test-docker.sh ts --scenario trending-feed --no-build ; ./scripts/test-docker.ps1 ts -Scenario trending-feed -NoBuild | /trending /following ルート専用の Vitest セットを Docker で再実行し、test-results/trending-feed/*.json と tmp/logs/trending-feed_<timestamp>.log を生成。VITE_TRENDING_FIXTURE_PATH でフィクスチャを指定する。 | 2025年11月10日: `./scripts/test-docker.sh ts --scenario trending-feed --no-build` をローカルで実行し、`tmp/logs/trending-feed_20251110020528.log` と `test-results/trending-feed/` のJSONを更新。Nightly と同一シナリオでトレンド/フォロー UI ログを取得済み。 |
| pnpm vitest TopicSelector/PostCard/TrendingSummaryPanel | pnpm vitest run src/tests/unit/components/topics/TopicSelector.test.tsx src/tests/unit/components/posts/PostCard.test.tsx src/tests/unit/routes/trending.test.tsx src/tests/unit/routes/following.test.tsx | グローバルコンポーザーのトピック作成／投稿削除キャッシュ／Summary Panel（トレンド/フォロー）のユニットテストを網羅し、tmp/logs/vitest_trending_topics_<timestamp>.log を保存。 | 2025年11月10日: corepack セットアップ後に `pnpm vitest run …` を再実行し、トレンド/フォロー UI とポスト系テストをまとめて完走。ログ: `tmp/logs/vitest_trending_topics_20251110020449.log`。 |
