# 進捗レポート: iroh-gossip統合設計

**日付**: 2025年07月26日  
**作業者**: Claude  
**カテゴリ**: 設計・アーキテクチャ

## 概要

Kukuriアプリケーションへのiroh-gossip統合に向けて、詳細な設計と実装計画を策定しました。

## 実施内容

### 1. 技術調査

**iroh-gossipの調査**:
- 公式ドキュメントを確認（https://docs.rs/iroh-gossip/）
- epidemic broadcast treesベースの実装（HyParView + PlumTree）
- トピックベースのメッセージ配信機能
- iroh（QUIC-based P2P）との統合

**irohの調査**:
- 公式ドキュメントを確認（https://docs.rs/iroh/）
- ホールパンチングによるP2P接続
- リレーサーバーのサポート
- NodeIdベースの認証

### 2. 設計ドキュメント作成

**統合設計書**（`iroh_gossip_integration_design.md`）:
- アーキテクチャ概要
- 主要コンポーネント設計（GossipManager、TopicMesh、EventSync）
- メッセージフォーマット定義
- セキュリティ考慮事項
- テスト計画

**主な設計決定**:
1. **モジュール構成**: `src/modules/p2p/`に新規P2Pモジュールを配置
2. **メッセージ形式**: Nostrイベントと互換性のあるGossipMessage形式
3. **トピックID**: `kukuri:topic:{name}`形式で生成
4. **ハイブリッド配信**: NostrリレーとP2Pの並列配信

### 3. 実装計画策定

**10日間の実装計画**（`iroh_gossip_implementation_plan.md`）:
- Phase 1: 基礎実装（2日間）
- Phase 2: トピック管理（3日間）
- Phase 3: Nostr統合（3日間）
- Phase 4: 最適化とUI統合（2日間）

**具体的なタスク**:
- 依存関係の追加（iroh 0.90.0、iroh-gossip 0.90.0）
- Tauriコマンドの定義
- TypeScript APIインターフェース
- テスト戦略

### 4. ドキュメント更新

- **CLAUDE.md**: iroh公式ドキュメントURLを追加
- **README.md**: 外部リソースセクションを追加、React バージョン修正（19→18）

## 技術的な洞察

### iroh-gossipの利点
1. **効率的な配信**: epidemic broadcast treesによる最適化されたメッセージ配信
2. **スケーラビリティ**: 大規模ネットワークでも効率的に動作
3. **iroh統合**: QUICベースの高速通信とシームレスに統合

### 実装上の課題
1. **初期ピア発見**: 最初の接続確立方法の検討が必要
2. **NAT越え**: irohのホールパンチング機能の活用
3. **メッセージ重複**: 効果的なキャッシュメカニズムが必要

### Nostrとの統合戦略
1. **双方向変換**: NostrイベントとGossipMessageの相互変換
2. **並列配信**: 信頼性向上のためのハイブリッドアプローチ
3. **認証統合**: Nostr公開鍵とiroh NodeIdの紐付け

## 次のステップ

1. **現在のアプリケーション動作確認**
   - MVPの動作確認
   - 統合前の状態把握

2. **実装開始**
   - 依存関係の追加
   - 基本モジュール構造の作成
   - 初期テストの実装

3. **段階的統合**
   - 計画に従って各フェーズを実装
   - 各フェーズ完了時にテスト実施

## リスクと軽減策

1. **技術的リスク**
   - iroh-gossipの安定性 → 十分なテストとフォールバック機能
   - パフォーマンス問題 → 段階的な最適化とモニタリング

2. **統合リスク**
   - 既存機能への影響 → 機能フラグによる段階的有効化
   - 複雑性の増加 → 明確なインターフェース設計

## まとめ

iroh-gossip統合により、Kukuriは真の分散型P2Pソーシャルプラットフォームへと進化します。詳細な設計と実装計画により、スムーズな統合が期待できます。